AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[item_sk#1 ASC NULLS FIRST,d_date#2 ASC NULLS FIRST], output=[item_sk#1,d_date#2,web_sales#3,store_sales#4,web_cumulative#5,store_cumulative#6])
   +- *(3) Filter ((isnotnull(web_cumulative#5) AND isnotnull(store_cumulative#6)) AND (web_cumulative#5 > store_cumulative#6))
      +- Window [max(web_sales#3) windowspecdefinition(item_sk#1, d_date#2 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#5, max(store_sales#4) windowspecdefinition(item_sk#1, d_date#2 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#6], [item_sk#1], [d_date#2 ASC NULLS FIRST]
         +- NativeSort [item_sk#1 ASC NULLS FIRST, d_date#2 ASC NULLS FIRST], false
            +- InputAdapter
               +- AQEShuffleRead coalesced
                  +- ShuffleQueryStage 11
                     +- NativeShuffleExchange hashpartitioning(item_sk#1, 100), ENSURE_REQUIREMENTS, [plan_id=1]
                        +- NativeProject [CASE WHEN isnotnull(item_sk#7) THEN item_sk#7 ELSE item_sk#8 END AS item_sk#1, CASE WHEN isnotnull(d_date#9) THEN d_date#9 ELSE d_date#10 END AS d_date#2, cume_sales#11 AS web_sales#3, cume_sales#12 AS store_sales#4]
                           +- NativeSortMergeJoin [item_sk#7, d_date#9], [item_sk#8, d_date#10], FullOuter
                              :- NativeSort [item_sk#7 ASC NULLS FIRST, d_date#9 ASC NULLS FIRST], false
                              :  +- InputAdapter
                              :     +- AQEShuffleRead coalesced
                              :        +- ShuffleQueryStage 9
                              :           +- NativeShuffleExchange hashpartitioning(item_sk#7, d_date#9, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                              :              +- ConvertToNative
                              :                 +- *(1) Project [item_sk#7, d_date#9, cume_sales#11]
                              :                    +- Window [sum(_w0#13) windowspecdefinition(ws_item_sk#14, d_date#9 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#11], [ws_item_sk#14], [d_date#9 ASC NULLS FIRST]
                              :                       +- NativeSort [ws_item_sk#14 ASC NULLS FIRST, d_date#9 ASC NULLS FIRST], false
                              :                          +- InputAdapter
                              :                             +- AQEShuffleRead coalesced
                              :                                +- ShuffleQueryStage 7
                              :                                   +- NativeShuffleExchange hashpartitioning(ws_item_sk#14, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                              :                                      +- NativeProject [ws_item_sk#14 AS item_sk#7, d_date#9, MakeDecimal(sum(UnscaledValue(ws_sales_price#15))#16,17,2) AS _w0#13, ws_item_sk#14]
                              :                                         +- NativeHashAggregate HashAgg, ArrayBuffer(ws_item_sk#14, d_date#9), [ws_item_sk#14, d_date#9], [sum(UnscaledValue(ws_sales_price#15))], [sum(UnscaledValue(ws_sales_price#15))#16], 2
                              :                                            +- InputAdapter
                              :                                               +- AQEShuffleRead coalesced
                              :                                                  +- ShuffleQueryStage 5
                              :                                                     +- NativeShuffleExchange hashpartitioning(ws_item_sk#14, d_date#9, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                              :                                                        +- NativeHashAggregate HashAgg, [ws_item_sk#14, d_date#9], [partial_sum(_c2#17)], [sum#18], 0
                              :                                                           +- NativeProject [ws_item_sk#14 AS ws_item_sk#14, d_date#9 AS d_date#9, UnscaledValue(ws_sales_price#15) AS _c2#17]
                              :                                                              +- NativeProject [ws_item_sk#14, ws_sales_price#15, d_date#9]
                              :                                                                 +- NativeSortMergeJoin [ws_sold_date_sk#19], [d_date_sk#20], Inner
                              :                                                                    :- NativeSort [ws_sold_date_sk#19 ASC NULLS FIRST], false
                              :                                                                    :  +- InputAdapter
                              :                                                                    :     +- AQEShuffleRead coalesced
                              :                                                                    :        +- ShuffleQueryStage 0
                              :                                                                    :           +- NativeShuffleExchange hashpartitioning(ws_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                              :                                                                    :              +- NativeFilter (isnotnull(ws_item_sk#14) AND isnotnull(ws_sold_date_sk#19))
                              :                                                                    :                 +- InputAdapter [#19, #14, #15]
                              :                                                                    :                    +- NativeParquetScan  (FileScan parquet [ws_sold_date_sk#19,ws_item_sk#14,ws_sales_price#15] Batched: true, DataFilters: [isnotnull(ws_item_sk#14), isnotnull(ws_sold_date_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_sales_price:decimal(7,2)>)
                              :                                                                    +- NativeSort [d_date_sk#20 ASC NULLS FIRST], false
                              :                                                                       +- InputAdapter
                              :                                                                          +- AQEShuffleRead coalesced
                              :                                                                             +- ShuffleQueryStage 1
                              :                                                                                +- NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                              :                                                                                   +- NativeProject [d_date_sk#20, d_date#9]
                              :                                                                                      +- NativeFilter (((isnotnull(d_month_seq#21) AND (d_month_seq#21 >= 1200)) AND (d_month_seq#21 <= 1211)) AND isnotnull(d_date_sk#20))
                              :                                                                                         +- InputAdapter [#20, #9, #21]
                              :                                                                                            +- NativeParquetScan  (FileScan parquet [d_date_sk#20,d_date#9,d_month_seq#21] Batched: true, DataFilters: [isnotnull(d_month_seq#21), (d_month_seq#21 >= 1200), (d_month_seq#21 <= 1211), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_date:date,d_month_seq:int>)
                              +- NativeSort [item_sk#8 ASC NULLS FIRST, d_date#10 ASC NULLS FIRST], false
                                 +- InputAdapter
                                    +- AQEShuffleRead coalesced
                                       +- ShuffleQueryStage 10
                                          +- NativeShuffleExchange hashpartitioning(item_sk#8, d_date#10, 100), ENSURE_REQUIREMENTS, [plan_id=7]
                                             +- ConvertToNative
                                                +- *(2) Project [item_sk#8, d_date#10, cume_sales#12]
                                                   +- Window [sum(_w0#22) windowspecdefinition(ss_item_sk#23, d_date#10 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#12], [ss_item_sk#23], [d_date#10 ASC NULLS FIRST]
                                                      +- NativeSort [ss_item_sk#23 ASC NULLS FIRST, d_date#10 ASC NULLS FIRST], false
                                                         +- InputAdapter
                                                            +- AQEShuffleRead coalesced
                                                               +- ShuffleQueryStage 8
                                                                  +- NativeShuffleExchange hashpartitioning(ss_item_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=8]
                                                                     +- NativeProject [ss_item_sk#23 AS item_sk#8, d_date#10, MakeDecimal(sum(UnscaledValue(ss_sales_price#24))#25,17,2) AS _w0#22, ss_item_sk#23]
                                                                        +- NativeHashAggregate HashAgg, ArrayBuffer(ss_item_sk#23, d_date#10), [ss_item_sk#23, d_date#10], [sum(UnscaledValue(ss_sales_price#24))], [sum(UnscaledValue(ss_sales_price#24))#25], 2
                                                                           +- InputAdapter
                                                                              +- AQEShuffleRead coalesced
                                                                                 +- ShuffleQueryStage 6
                                                                                    +- NativeShuffleExchange hashpartitioning(ss_item_sk#23, d_date#10, 100), ENSURE_REQUIREMENTS, [plan_id=9]
                                                                                       +- NativeHashAggregate HashAgg, [ss_item_sk#23, d_date#10], [partial_sum(_c2#26)], [sum#27], 0
                                                                                          +- NativeProject [ss_item_sk#23 AS ss_item_sk#23, d_date#10 AS d_date#10, UnscaledValue(ss_sales_price#24) AS _c2#26]
                                                                                             +- NativeProject [ss_item_sk#23, ss_sales_price#24, d_date#10]
                                                                                                +- NativeSortMergeJoin [ss_sold_date_sk#28], [d_date_sk#29], Inner
                                                                                                   :- NativeSort [ss_sold_date_sk#28 ASC NULLS FIRST], false
                                                                                                   :  +- InputAdapter
                                                                                                   :     +- AQEShuffleRead coalesced
                                                                                                   :        +- ShuffleQueryStage 2
                                                                                                   :           +- NativeShuffleExchange hashpartitioning(ss_sold_date_sk#28, 100), ENSURE_REQUIREMENTS, [plan_id=10]
                                                                                                   :              +- NativeFilter (isnotnull(ss_item_sk#23) AND isnotnull(ss_sold_date_sk#28))
                                                                                                   :                 +- InputAdapter [#28, #23, #24]
                                                                                                   :                    +- NativeParquetScan  (FileScan parquet [ss_sold_date_sk#28,ss_item_sk#23,ss_sales_price#24] Batched: true, DataFilters: [isnotnull(ss_item_sk#23), isnotnull(ss_sold_date_sk#28)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_sales_price:decimal(7,2)>)
                                                                                                   +- NativeSort [d_date_sk#29 ASC NULLS FIRST], false
                                                                                                      +- InputAdapter
                                                                                                         +- InputAdapter [#29, #10]
                                                                                                            +- AQEShuffleRead coalesced
                                                                                                               +- ShuffleQueryStage 4
                                                                                                                  +- ReusedExchange [d_date_sk#29, d_date#10], NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=6]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[item_sk#1 ASC NULLS FIRST,d_date#2 ASC NULLS FIRST], output=[item_sk#1,d_date#2,web_sales#3,store_sales#4,web_cumulative#5,store_cumulative#6])
   +- Filter ((isnotnull(web_cumulative#5) AND isnotnull(store_cumulative#6)) AND (web_cumulative#5 > store_cumulative#6))
      +- Window [max(web_sales#3) windowspecdefinition(item_sk#1, d_date#2 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#5, max(store_sales#4) windowspecdefinition(item_sk#1, d_date#2 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#6], [item_sk#1], [d_date#2 ASC NULLS FIRST]
         +- Sort [item_sk#1 ASC NULLS FIRST, d_date#2 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(item_sk#1, 100), ENSURE_REQUIREMENTS, [plan_id=11]
               +- Project [CASE WHEN isnotnull(item_sk#7) THEN item_sk#7 ELSE item_sk#8 END AS item_sk#1, CASE WHEN isnotnull(d_date#9) THEN d_date#9 ELSE d_date#10 END AS d_date#2, cume_sales#11 AS web_sales#3, cume_sales#12 AS store_sales#4]
                  +- SortMergeJoin [item_sk#7, d_date#9], [item_sk#8, d_date#10], FullOuter
                     :- Sort [item_sk#7 ASC NULLS FIRST, d_date#9 ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(item_sk#7, d_date#9, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                     :     +- Project [item_sk#7, d_date#9, cume_sales#11]
                     :        +- Window [sum(_w0#13) windowspecdefinition(ws_item_sk#14, d_date#9 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#11], [ws_item_sk#14], [d_date#9 ASC NULLS FIRST]
                     :           +- Sort [ws_item_sk#14 ASC NULLS FIRST, d_date#9 ASC NULLS FIRST], false, 0
                     :              +- Exchange hashpartitioning(ws_item_sk#14, 100), ENSURE_REQUIREMENTS, [plan_id=13]
                     :                 +- HashAggregate(keys=[ws_item_sk#14, d_date#9], functions=[sum(UnscaledValue(ws_sales_price#15))], output=[item_sk#7, d_date#9, _w0#13, ws_item_sk#14])
                     :                    +- Exchange hashpartitioning(ws_item_sk#14, d_date#9, 100), ENSURE_REQUIREMENTS, [plan_id=14]
                     :                       +- HashAggregate(keys=[ws_item_sk#14, d_date#9], functions=[partial_sum(UnscaledValue(ws_sales_price#15))], output=[ws_item_sk#14, d_date#9, sum#30])
                     :                          +- Project [ws_item_sk#14, ws_sales_price#15, d_date#9]
                     :                             +- SortMergeJoin [ws_sold_date_sk#19], [d_date_sk#20], Inner
                     :                                :- Sort [ws_sold_date_sk#19 ASC NULLS FIRST], false, 0
                     :                                :  +- Exchange hashpartitioning(ws_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=15]
                     :                                :     +- Filter (isnotnull(ws_item_sk#14) AND isnotnull(ws_sold_date_sk#19))
                     :                                :        +- FileScan parquet [ws_sold_date_sk#19,ws_item_sk#14,ws_sales_price#15] Batched: true, DataFilters: [isnotnull(ws_item_sk#14), isnotnull(ws_sold_date_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_sales_price:decimal(7,2)>
                     :                                +- Sort [d_date_sk#20 ASC NULLS FIRST], false, 0
                     :                                   +- Exchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=16]
                     :                                      +- Project [d_date_sk#20, d_date#9]
                     :                                         +- Filter (((isnotnull(d_month_seq#21) AND (d_month_seq#21 >= 1200)) AND (d_month_seq#21 <= 1211)) AND isnotnull(d_date_sk#20))
                     :                                            +- FileScan parquet [d_date_sk#20,d_date#9,d_month_seq#21] Batched: true, DataFilters: [isnotnull(d_month_seq#21), (d_month_seq#21 >= 1200), (d_month_seq#21 <= 1211), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_date:date,d_month_seq:int>
                     +- Sort [item_sk#8 ASC NULLS FIRST, d_date#10 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(item_sk#8, d_date#10, 100), ENSURE_REQUIREMENTS, [plan_id=17]
                           +- Project [item_sk#8, d_date#10, cume_sales#12]
                              +- Window [sum(_w0#22) windowspecdefinition(ss_item_sk#23, d_date#10 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#12], [ss_item_sk#23], [d_date#10 ASC NULLS FIRST]
                                 +- Sort [ss_item_sk#23 ASC NULLS FIRST, d_date#10 ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(ss_item_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=18]
                                       +- HashAggregate(keys=[ss_item_sk#23, d_date#10], functions=[sum(UnscaledValue(ss_sales_price#24))], output=[item_sk#8, d_date#10, _w0#22, ss_item_sk#23])
                                          +- Exchange hashpartitioning(ss_item_sk#23, d_date#10, 100), ENSURE_REQUIREMENTS, [plan_id=19]
                                             +- HashAggregate(keys=[ss_item_sk#23, d_date#10], functions=[partial_sum(UnscaledValue(ss_sales_price#24))], output=[ss_item_sk#23, d_date#10, sum#31])
                                                +- Project [ss_item_sk#23, ss_sales_price#24, d_date#10]
                                                   +- SortMergeJoin [ss_sold_date_sk#28], [d_date_sk#29], Inner
                                                      :- Sort [ss_sold_date_sk#28 ASC NULLS FIRST], false, 0
                                                      :  +- Exchange hashpartitioning(ss_sold_date_sk#28, 100), ENSURE_REQUIREMENTS, [plan_id=20]
                                                      :     +- Filter (isnotnull(ss_item_sk#23) AND isnotnull(ss_sold_date_sk#28))
                                                      :        +- FileScan parquet [ss_sold_date_sk#28,ss_item_sk#23,ss_sales_price#24] Batched: true, DataFilters: [isnotnull(ss_item_sk#23), isnotnull(ss_sold_date_sk#28)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_sales_price:decimal(7,2)>
                                                      +- Sort [d_date_sk#29 ASC NULLS FIRST], false, 0
                                                         +- Exchange hashpartitioning(d_date_sk#29, 100), ENSURE_REQUIREMENTS, [plan_id=21]
                                                            +- Project [d_date_sk#29, d_date#10]
                                                               +- Filter (((isnotnull(d_month_seq#32) AND (d_month_seq#32 >= 1200)) AND (d_month_seq#32 <= 1211)) AND isnotnull(d_date_sk#29))
                                                                  +- FileScan parquet [d_date_sk#29,d_date#10,d_month_seq#32] Batched: true, DataFilters: [isnotnull(d_month_seq#32), (d_month_seq#32 >= 1200), (d_month_seq#32 <= 1211), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_date:date,d_month_seq:int>
