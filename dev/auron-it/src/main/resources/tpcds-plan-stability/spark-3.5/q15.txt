AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeTakeOrdered 100, [ca_zip#1 ASC NULLS FIRST]
   +- NativeProject [ca_zip#1, MakeDecimal(sum(UnscaledValue(cs_sales_price#2))#3,17,2) AS sum(cs_sales_price)#4]
      +- NativeHashAggregate HashAgg, ArrayBuffer(ca_zip#1), [ca_zip#1], [sum(UnscaledValue(cs_sales_price#2))], [sum(UnscaledValue(cs_sales_price#2))#3], 1
         +- InputAdapter
            +- AQEShuffleRead coalesced
               +- ShuffleQueryStage 6
                  +- NativeShuffleExchange hashpartitioning(ca_zip#1, 100), ENSURE_REQUIREMENTS, [plan_id=1]
                     +- NativeHashAggregate HashAgg, [ca_zip#1], [partial_sum(_c1#5)], [sum#6], 0
                        +- NativeProject [ca_zip#1 AS ca_zip#1, UnscaledValue(cs_sales_price#2) AS _c1#5]
                           +- NativeProject [cs_sales_price#2, ca_zip#1]
                              +- NativeSortMergeJoin [cs_sold_date_sk#7], [d_date_sk#8], Inner
                                 :- NativeSort [cs_sold_date_sk#7 ASC NULLS FIRST], false
                                 :  +- InputAdapter
                                 :     +- AQEShuffleRead coalesced
                                 :        +- ShuffleQueryStage 5
                                 :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#7, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                                 :              +- ConvertToNative
                                 :                 +- *(1) Project [cs_sold_date_sk#7, cs_sales_price#2, ca_zip#1]
                                 :                    +- *(1) SortMergeJoin [c_current_addr_sk#9], [ca_address_sk#10], Inner, ((substr(ca_zip#1, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR ca_state#11 IN (CA,WA,GA)) OR (cs_sales_price#2 > 500.00))
                                 :                       :- NativeSort [c_current_addr_sk#9 ASC NULLS FIRST], false
                                 :                       :  +- InputAdapter
                                 :                       :     +- AQEShuffleRead coalesced
                                 :                       :        +- ShuffleQueryStage 4
                                 :                       :           +- NativeShuffleExchange hashpartitioning(c_current_addr_sk#9, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                                 :                       :              +- NativeProject [cs_sold_date_sk#7, cs_sales_price#2, c_current_addr_sk#9]
                                 :                       :                 +- NativeSortMergeJoin [cs_bill_customer_sk#12], [c_customer_sk#13], Inner
                                 :                       :                    :- NativeSort [cs_bill_customer_sk#12 ASC NULLS FIRST], false
                                 :                       :                    :  +- InputAdapter
                                 :                       :                    :     +- AQEShuffleRead coalesced
                                 :                       :                    :        +- ShuffleQueryStage 0
                                 :                       :                    :           +- NativeShuffleExchange hashpartitioning(cs_bill_customer_sk#12, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                                 :                       :                    :              +- NativeFilter (isnotnull(cs_bill_customer_sk#12) AND isnotnull(cs_sold_date_sk#7))
                                 :                       :                    :                 +- InputAdapter [#7, #12, #2]
                                 :                       :                    :                    +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#7,cs_bill_customer_sk#12,cs_sales_price#2] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#12), isnotnull(cs_sold_date_sk#7)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_sales_price:decimal(7,2)>)
                                 :                       :                    +- NativeSort [c_customer_sk#13 ASC NULLS FIRST], false
                                 :                       :                       +- InputAdapter
                                 :                       :                          +- AQEShuffleRead coalesced
                                 :                       :                             +- ShuffleQueryStage 1
                                 :                       :                                +- NativeShuffleExchange hashpartitioning(c_customer_sk#13, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                                 :                       :                                   +- NativeFilter (isnotnull(c_customer_sk#13) AND isnotnull(c_current_addr_sk#9))
                                 :                       :                                      +- InputAdapter [#13, #9]
                                 :                       :                                         +- NativeParquetScan  (FileScan parquet [c_customer_sk#13,c_current_addr_sk#9] Batched: true, DataFilters: [isnotnull(c_customer_sk#13), isnotnull(c_current_addr_sk#9)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>)
                                 :                       +- NativeSort [ca_address_sk#10 ASC NULLS FIRST], false
                                 :                          +- InputAdapter
                                 :                             +- AQEShuffleRead coalesced
                                 :                                +- ShuffleQueryStage 2
                                 :                                   +- NativeShuffleExchange hashpartitioning(ca_address_sk#10, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                                 :                                      +- NativeFilter isnotnull(ca_address_sk#10)
                                 :                                         +- InputAdapter [#10, #11, #1]
                                 :                                            +- NativeParquetScan  (FileScan parquet [ca_address_sk#10,ca_state#11,ca_zip#1] Batched: true, DataFilters: [isnotnull(ca_address_sk#10)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string,ca_zip:string>)
                                 +- NativeSort [d_date_sk#8 ASC NULLS FIRST], false
                                    +- InputAdapter
                                       +- AQEShuffleRead coalesced
                                          +- ShuffleQueryStage 3
                                             +- NativeShuffleExchange hashpartitioning(d_date_sk#8, 100), ENSURE_REQUIREMENTS, [plan_id=7]
                                                +- NativeProject [d_date_sk#8]
                                                   +- NativeFilter ((((isnotnull(d_qoy#14) AND isnotnull(d_year#15)) AND (d_qoy#14 = 2)) AND (d_year#15 = 2001)) AND isnotnull(d_date_sk#8))
                                                      +- InputAdapter [#8, #15, #14]
                                                         +- NativeParquetScan  (FileScan parquet [d_date_sk#8,d_year#15,d_qoy#14] Batched: true, DataFilters: [isnotnull(d_qoy#14), isnotnull(d_year#15), (d_qoy#14 = 2), (d_year#15 = 2001), isnot..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>)
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[ca_zip#1 ASC NULLS FIRST], output=[ca_zip#1,sum(cs_sales_price)#4])
   +- HashAggregate(keys=[ca_zip#1], functions=[sum(UnscaledValue(cs_sales_price#2))], output=[ca_zip#1, sum(cs_sales_price)#4])
      +- Exchange hashpartitioning(ca_zip#1, 100), ENSURE_REQUIREMENTS, [plan_id=8]
         +- HashAggregate(keys=[ca_zip#1], functions=[partial_sum(UnscaledValue(cs_sales_price#2))], output=[ca_zip#1, sum#16])
            +- Project [cs_sales_price#2, ca_zip#1]
               +- SortMergeJoin [cs_sold_date_sk#7], [d_date_sk#8], Inner
                  :- Sort [cs_sold_date_sk#7 ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(cs_sold_date_sk#7, 100), ENSURE_REQUIREMENTS, [plan_id=9]
                  :     +- Project [cs_sold_date_sk#7, cs_sales_price#2, ca_zip#1]
                  :        +- SortMergeJoin [c_current_addr_sk#9], [ca_address_sk#10], Inner, ((substr(ca_zip#1, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) OR ca_state#11 IN (CA,WA,GA)) OR (cs_sales_price#2 > 500.00))
                  :           :- Sort [c_current_addr_sk#9 ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(c_current_addr_sk#9, 100), ENSURE_REQUIREMENTS, [plan_id=10]
                  :           :     +- Project [cs_sold_date_sk#7, cs_sales_price#2, c_current_addr_sk#9]
                  :           :        +- SortMergeJoin [cs_bill_customer_sk#12], [c_customer_sk#13], Inner
                  :           :           :- Sort [cs_bill_customer_sk#12 ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(cs_bill_customer_sk#12, 100), ENSURE_REQUIREMENTS, [plan_id=11]
                  :           :           :     +- Filter (isnotnull(cs_bill_customer_sk#12) AND isnotnull(cs_sold_date_sk#7))
                  :           :           :        +- FileScan parquet [cs_sold_date_sk#7,cs_bill_customer_sk#12,cs_sales_price#2] Batched: true, DataFilters: [isnotnull(cs_bill_customer_sk#12), isnotnull(cs_sold_date_sk#7)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_bill_customer_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_sales_price:decimal(7,2)>
                  :           :           +- Sort [c_customer_sk#13 ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(c_customer_sk#13, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                  :           :                 +- Filter (isnotnull(c_customer_sk#13) AND isnotnull(c_current_addr_sk#9))
                  :           :                    +- FileScan parquet [c_customer_sk#13,c_current_addr_sk#9] Batched: true, DataFilters: [isnotnull(c_customer_sk#13), isnotnull(c_current_addr_sk#9)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>
                  :           +- Sort [ca_address_sk#10 ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(ca_address_sk#10, 100), ENSURE_REQUIREMENTS, [plan_id=13]
                  :                 +- Filter isnotnull(ca_address_sk#10)
                  :                    +- FileScan parquet [ca_address_sk#10,ca_state#11,ca_zip#1] Batched: true, DataFilters: [isnotnull(ca_address_sk#10)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string,ca_zip:string>
                  +- Sort [d_date_sk#8 ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(d_date_sk#8, 100), ENSURE_REQUIREMENTS, [plan_id=14]
                        +- Project [d_date_sk#8]
                           +- Filter ((((isnotnull(d_qoy#14) AND isnotnull(d_year#15)) AND (d_qoy#14 = 2)) AND (d_year#15 = 2001)) AND isnotnull(d_date_sk#8))
                              +- FileScan parquet [d_date_sk#8,d_year#15,d_qoy#14] Batched: true, DataFilters: [isnotnull(d_qoy#14), isnotnull(d_year#15), (d_qoy#14 = 2), (d_year#15 = 2001), isnot..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>
