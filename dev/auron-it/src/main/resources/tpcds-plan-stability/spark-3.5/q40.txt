AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeTakeOrdered 100, [w_state#1 ASC NULLS FIRST, i_item_id#2 ASC NULLS FIRST]
   +- NativeProject [w_state#1, i_item_id#2, sum(CASE WHEN (d_date#3 < 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)#6 AS sales_before#7, sum(CASE WHEN (d_date#3 >= 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)#8 AS sales_after#9]
      +- NativeHashAggregate HashAgg, ArrayBuffer(w_state#1, i_item_id#2), [w_state#1, i_item_id#2], [sum(CASE WHEN (d_date#3 < 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END), sum(CASE WHEN (d_date#3 >= 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)], [sum(CASE WHEN (d_date#3 < 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)#6, sum(CASE WHEN (d_date#3 >= 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)#8], 2
         +- InputAdapter
            +- AQEShuffleRead coalesced
               +- ShuffleQueryStage 8
                  +- NativeShuffleExchange hashpartitioning(w_state#1, i_item_id#2, 100), ENSURE_REQUIREMENTS, [plan_id=1]
                     +- NativeHashAggregate HashAgg, [w_state#1, i_item_id#2], [partial_sum(_c2#10), partial_sum(_c3#11)], [sum#12, isEmpty#13, sum#14, isEmpty#15], 0
                        +- NativeProject [w_state#1 AS w_state#1, i_item_id#2 AS i_item_id#2, CASE WHEN (d_date#3 < 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END AS _c2#10, CASE WHEN (d_date#3 >= 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END AS _c3#11]
                           +- NativeProject [cs_sales_price#4, cr_refunded_cash#5, w_state#1, i_item_id#2, d_date#3]
                              +- NativeSortMergeJoin [cs_sold_date_sk#16], [d_date_sk#17], Inner
                                 :- NativeSort [cs_sold_date_sk#16 ASC NULLS FIRST], false
                                 :  +- InputAdapter
                                 :     +- AQEShuffleRead coalesced
                                 :        +- ShuffleQueryStage 7
                                 :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#16, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                                 :              +- NativeProject [cs_sold_date_sk#16, cs_sales_price#4, cr_refunded_cash#5, w_state#1, i_item_id#2]
                                 :                 +- NativeSortMergeJoin [cs_item_sk#18], [i_item_sk#19], Inner
                                 :                    :- NativeSort [cs_item_sk#18 ASC NULLS FIRST], false
                                 :                    :  +- InputAdapter
                                 :                    :     +- AQEShuffleRead coalesced
                                 :                    :        +- ShuffleQueryStage 6
                                 :                    :           +- NativeShuffleExchange hashpartitioning(cs_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                                 :                    :              +- NativeProject [cs_sold_date_sk#16, cs_item_sk#18, cs_sales_price#4, cr_refunded_cash#5, w_state#1]
                                 :                    :                 +- NativeSortMergeJoin [cs_warehouse_sk#20], [w_warehouse_sk#21], Inner
                                 :                    :                    :- NativeSort [cs_warehouse_sk#20 ASC NULLS FIRST], false
                                 :                    :                    :  +- InputAdapter
                                 :                    :                    :     +- AQEShuffleRead coalesced
                                 :                    :                    :        +- ShuffleQueryStage 5
                                 :                    :                    :           +- NativeShuffleExchange hashpartitioning(cs_warehouse_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                                 :                    :                    :              +- NativeProject [cs_sold_date_sk#16, cs_warehouse_sk#20, cs_item_sk#18, cs_sales_price#4, cr_refunded_cash#5]
                                 :                    :                    :                 +- NativeSortMergeJoin [cs_order_number#22, cs_item_sk#18], [cr_order_number#23, cr_item_sk#24], LeftOuter
                                 :                    :                    :                    :- NativeSort [cs_order_number#22 ASC NULLS FIRST, cs_item_sk#18 ASC NULLS FIRST], false
                                 :                    :                    :                    :  +- InputAdapter
                                 :                    :                    :                    :     +- AQEShuffleRead coalesced
                                 :                    :                    :                    :        +- ShuffleQueryStage 0
                                 :                    :                    :                    :           +- NativeShuffleExchange hashpartitioning(cs_order_number#22, cs_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                                 :                    :                    :                    :              +- NativeFilter ((isnotnull(cs_warehouse_sk#20) AND isnotnull(cs_item_sk#18)) AND isnotnull(cs_sold_date_sk#16))
                                 :                    :                    :                    :                 +- InputAdapter [#16, #20, #18, #22, #4]
                                 :                    :                    :                    :                    +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#16,cs_warehouse_sk#20,cs_item_sk#18,cs_order_number#22,cs_sales_price#4] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#20), isnotnull(cs_item_sk#18), isnotnull(cs_sold_date_sk#16)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_warehouse_sk:int,cs_item_sk:int,cs_order_number:int,cs_sales_price:...)
                                 :                    :                    :                    +- NativeSort [cr_order_number#23 ASC NULLS FIRST, cr_item_sk#24 ASC NULLS FIRST], false
                                 :                    :                    :                       +- InputAdapter
                                 :                    :                    :                          +- AQEShuffleRead coalesced
                                 :                    :                    :                             +- ShuffleQueryStage 1
                                 :                    :                    :                                +- NativeShuffleExchange hashpartitioning(cr_order_number#23, cr_item_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                                 :                    :                    :                                   +- NativeFilter (isnotnull(cr_order_number#23) AND isnotnull(cr_item_sk#24))
                                 :                    :                    :                                      +- InputAdapter [#24, #23, #5]
                                 :                    :                    :                                         +- NativeParquetScan  (FileScan parquet [cr_item_sk#24,cr_order_number#23,cr_refunded_cash#5] Batched: true, DataFilters: [isnotnull(cr_order_number#23), isnotnull(cr_item_sk#24)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cr_order_number), IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:int,cr_order_number:int,cr_refunded_cash:decimal(7,2)>)
                                 :                    :                    +- NativeSort [w_warehouse_sk#21 ASC NULLS FIRST], false
                                 :                    :                       +- InputAdapter
                                 :                    :                          +- AQEShuffleRead coalesced
                                 :                    :                             +- ShuffleQueryStage 2
                                 :                    :                                +- NativeShuffleExchange hashpartitioning(w_warehouse_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=7]
                                 :                    :                                   +- NativeFilter isnotnull(w_warehouse_sk#21)
                                 :                    :                                      +- InputAdapter [#21, #1]
                                 :                    :                                         +- NativeParquetScan  (FileScan parquet [w_warehouse_sk#21,w_state#1] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#21)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_state:string>)
                                 :                    +- NativeSort [i_item_sk#19 ASC NULLS FIRST], false
                                 :                       +- InputAdapter
                                 :                          +- AQEShuffleRead coalesced
                                 :                             +- ShuffleQueryStage 3
                                 :                                +- NativeShuffleExchange hashpartitioning(i_item_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=8]
                                 :                                   +- NativeProject [i_item_sk#19, i_item_id#2]
                                 :                                      +- NativeFilter (((isnotnull(i_current_price#25) AND (i_current_price#25 >= 0.99)) AND (i_current_price#25 <= 1.49)) AND isnotnull(i_item_sk#19))
                                 :                                         +- InputAdapter [#19, #2, #25]
                                 :                                            +- NativeParquetScan  (FileScan parquet [i_item_sk#19,i_item_id#2,i_current_price#25] Batched: true, DataFilters: [isnotnull(i_current_price#25), (i_current_price#25 >= 0.99), (i_current_price#25 <= 1.4..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,0.99), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:int,i_item_id:string,i_current_price:decimal(7,2)>)
                                 +- NativeSort [d_date_sk#17 ASC NULLS FIRST], false
                                    +- InputAdapter
                                       +- AQEShuffleRead coalesced
                                          +- ShuffleQueryStage 4
                                             +- NativeShuffleExchange hashpartitioning(d_date_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=9]
                                                +- NativeFilter (((isnotnull(d_date#3) AND (d_date#3 >= 2000-02-10)) AND (d_date#3 <= 2000-04-10)) AND isnotnull(d_date_sk#17))
                                                   +- InputAdapter [#17, #3]
                                                      +- NativeParquetScan  (FileScan parquet [d_date_sk#17,d_date#3] Batched: true, DataFilters: [isnotnull(d_date#3), (d_date#3 >= 2000-02-10), (d_date#3 <= 2000-04-10), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-02-10), LessThanOrEqual(d_date,2000-04-10), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>)
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[w_state#1 ASC NULLS FIRST,i_item_id#2 ASC NULLS FIRST], output=[w_state#1,i_item_id#2,sales_before#7,sales_after#9])
   +- HashAggregate(keys=[w_state#1, i_item_id#2], functions=[sum(CASE WHEN (d_date#3 < 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END), sum(CASE WHEN (d_date#3 >= 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)], output=[w_state#1, i_item_id#2, sales_before#7, sales_after#9])
      +- Exchange hashpartitioning(w_state#1, i_item_id#2, 100), ENSURE_REQUIREMENTS, [plan_id=10]
         +- HashAggregate(keys=[w_state#1, i_item_id#2], functions=[partial_sum(CASE WHEN (d_date#3 < 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END), partial_sum(CASE WHEN (d_date#3 >= 2000-03-11) THEN (cs_sales_price#4 - coalesce(cast(cr_refunded_cash#5 as decimal(12,2)), 0.00)) ELSE 0.00 END)], output=[w_state#1, i_item_id#2, sum#26, isEmpty#27, sum#28, isEmpty#29])
            +- Project [cs_sales_price#4, cr_refunded_cash#5, w_state#1, i_item_id#2, d_date#3]
               +- SortMergeJoin [cs_sold_date_sk#16], [d_date_sk#17], Inner
                  :- Sort [cs_sold_date_sk#16 ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(cs_sold_date_sk#16, 100), ENSURE_REQUIREMENTS, [plan_id=11]
                  :     +- Project [cs_sold_date_sk#16, cs_sales_price#4, cr_refunded_cash#5, w_state#1, i_item_id#2]
                  :        +- SortMergeJoin [cs_item_sk#18], [i_item_sk#19], Inner
                  :           :- Sort [cs_item_sk#18 ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(cs_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                  :           :     +- Project [cs_sold_date_sk#16, cs_item_sk#18, cs_sales_price#4, cr_refunded_cash#5, w_state#1]
                  :           :        +- SortMergeJoin [cs_warehouse_sk#20], [w_warehouse_sk#21], Inner
                  :           :           :- Sort [cs_warehouse_sk#20 ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(cs_warehouse_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=13]
                  :           :           :     +- Project [cs_sold_date_sk#16, cs_warehouse_sk#20, cs_item_sk#18, cs_sales_price#4, cr_refunded_cash#5]
                  :           :           :        +- SortMergeJoin [cs_order_number#22, cs_item_sk#18], [cr_order_number#23, cr_item_sk#24], LeftOuter
                  :           :           :           :- Sort [cs_order_number#22 ASC NULLS FIRST, cs_item_sk#18 ASC NULLS FIRST], false, 0
                  :           :           :           :  +- Exchange hashpartitioning(cs_order_number#22, cs_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=14]
                  :           :           :           :     +- Filter ((isnotnull(cs_warehouse_sk#20) AND isnotnull(cs_item_sk#18)) AND isnotnull(cs_sold_date_sk#16))
                  :           :           :           :        +- FileScan parquet [cs_sold_date_sk#16,cs_warehouse_sk#20,cs_item_sk#18,cs_order_number#22,cs_sales_price#4] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#20), isnotnull(cs_item_sk#18), isnotnull(cs_sold_date_sk#16)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_warehouse_sk:int,cs_item_sk:int,cs_order_number:int,cs_sales_price:...
                  :           :           :           +- Sort [cr_order_number#23 ASC NULLS FIRST, cr_item_sk#24 ASC NULLS FIRST], false, 0
                  :           :           :              +- Exchange hashpartitioning(cr_order_number#23, cr_item_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=15]
                  :           :           :                 +- Filter (isnotnull(cr_order_number#23) AND isnotnull(cr_item_sk#24))
                  :           :           :                    +- FileScan parquet [cr_item_sk#24,cr_order_number#23,cr_refunded_cash#5] Batched: true, DataFilters: [isnotnull(cr_order_number#23), isnotnull(cr_item_sk#24)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cr_order_number), IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:int,cr_order_number:int,cr_refunded_cash:decimal(7,2)>
                  :           :           +- Sort [w_warehouse_sk#21 ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(w_warehouse_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=16]
                  :           :                 +- Filter isnotnull(w_warehouse_sk#21)
                  :           :                    +- FileScan parquet [w_warehouse_sk#21,w_state#1] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#21)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_state:string>
                  :           +- Sort [i_item_sk#19 ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(i_item_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=17]
                  :                 +- Project [i_item_sk#19, i_item_id#2]
                  :                    +- Filter (((isnotnull(i_current_price#25) AND (i_current_price#25 >= 0.99)) AND (i_current_price#25 <= 1.49)) AND isnotnull(i_item_sk#19))
                  :                       +- FileScan parquet [i_item_sk#19,i_item_id#2,i_current_price#25] Batched: true, DataFilters: [isnotnull(i_current_price#25), (i_current_price#25 >= 0.99), (i_current_price#25 <= 1.4..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,0.99), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:int,i_item_id:string,i_current_price:decimal(7,2)>
                  +- Sort [d_date_sk#17 ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(d_date_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=18]
                        +- Filter (((isnotnull(d_date#3) AND (d_date#3 >= 2000-02-10)) AND (d_date#3 <= 2000-04-10)) AND isnotnull(d_date_sk#17))
                           +- FileScan parquet [d_date_sk#17,d_date#3] Batched: true, DataFilters: [isnotnull(d_date#3), (d_date#3 >= 2000-02-10), (d_date#3 <= 2000-04-10), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-02-10), LessThanOrEqual(d_date,2000-04-10), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>
