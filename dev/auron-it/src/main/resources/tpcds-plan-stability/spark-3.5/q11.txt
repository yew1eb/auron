AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[customer_preferred_cust_flag#1 ASC NULLS FIRST], output=[customer_preferred_cust_flag#1])
   +- *(1) Project [customer_preferred_cust_flag#1]
      +- *(1) SortMergeJoin [customer_id#2], [customer_id#3], Inner, (CASE WHEN (year_total#4 > 0.00) THEN (year_total#5 / year_total#4) END > CASE WHEN (year_total#6 > 0.00) THEN (year_total#7 / year_total#6) END)
         :- NativeProject [customer_id#2, year_total#6, customer_preferred_cust_flag#1, year_total#7, year_total#4]
         :  +- NativeSortMergeJoin [customer_id#2], [customer_id#8], Inner
         :     :- NativeProject [customer_id#2, year_total#6, customer_preferred_cust_flag#1, year_total#7]
         :     :  +- NativeSortMergeJoin [customer_id#2], [customer_id#9], Inner
         :     :     :- NativeSort [customer_id#2 ASC NULLS FIRST], false
         :     :     :  +- InputAdapter
         :     :     :     +- AQEShuffleRead coalesced
         :     :     :        +- ShuffleQueryStage X
         :     :     :           +- NativeShuffleExchange hashpartitioning(customer_id#2, 100), ENSURE_REQUIREMENTS, [plan_id=1]
         :     :     :              +- NativeFilter (isnotnull(year_total#6) AND (year_total#6 > 0.00))
         :     :     :                 +- NativeProject [c_customer_id#10 AS customer_id#2, MakeDecimal(sum(UnscaledValue((ss_ext_list_price#11 - ss_ext_discount_amt#12)))#13,18,2) AS year_total#6]
         :     :     :                    +- NativeHashAggregate HashAgg, Vector(c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20), [c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20], [sum(UnscaledValue((ss_ext_list_price#11 - ss_ext_discount_amt#12)))], [sum(UnscaledValue((ss_ext_list_price#11 - ss_ext_discount_amt#12)))#13], 8
         :     :     :                       +- InputAdapter
         :     :     :                          +- AQEShuffleRead coalesced
         :     :     :                             +- ShuffleQueryStage X
         :     :     :                                +- NativeShuffleExchange hashpartitioning(c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, 100), ENSURE_REQUIREMENTS, [plan_id=2]
         :     :     :                                   +- NativeHashAggregate HashAgg, [c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20], [partial_sum(_c8#21)], [sum#22], 0
         :     :     :                                      +- NativeProject [c_customer_id#10 AS c_customer_id#10, c_first_name#14 AS c_first_name#14, c_last_name#15 AS c_last_name#15, d_year#16 AS d_year#16, c_preferred_cust_flag#17 AS c_preferred_cust_flag#17, c_birth_country#18 AS c_birth_country#18, c_login#19 AS c_login#19, c_email_address#20 AS c_email_address#20, UnscaledValue((ss_ext_list_price#11 - ss_ext_discount_amt#12)) AS _c8#21]
         :     :     :                                         +- NativeProject [c_customer_id#10, c_first_name#14, c_last_name#15, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, ss_ext_discount_amt#12, ss_ext_list_price#11, d_year#16]
         :     :     :                                            +- NativeSortMergeJoin [ss_sold_date_sk#23], [d_date_sk#24], Inner
         :     :     :                                               :- NativeSort [ss_sold_date_sk#23 ASC NULLS FIRST], false
         :     :     :                                               :  +- InputAdapter
         :     :     :                                               :     +- AQEShuffleRead coalesced
         :     :     :                                               :        +- ShuffleQueryStage X
         :     :     :                                               :           +- NativeShuffleExchange hashpartitioning(ss_sold_date_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=3]
         :     :     :                                               :              +- NativeProject [c_customer_id#10, c_first_name#14, c_last_name#15, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, ss_sold_date_sk#23, ss_ext_discount_amt#12, ss_ext_list_price#11]
         :     :     :                                               :                 +- NativeSortMergeJoin [c_customer_sk#25], [ss_customer_sk#26], Inner
         :     :     :                                               :                    :- NativeSort [c_customer_sk#25 ASC NULLS FIRST], false
         :     :     :                                               :                    :  +- InputAdapter
         :     :     :                                               :                    :     +- AQEShuffleRead coalesced
         :     :     :                                               :                    :        +- ShuffleQueryStage X
         :     :     :                                               :                    :           +- NativeShuffleExchange hashpartitioning(c_customer_sk#25, 100), ENSURE_REQUIREMENTS, [plan_id=4]
         :     :     :                                               :                    :              +- NativeFilter (isnotnull(c_customer_sk#25) AND isnotnull(c_customer_id#10))
         :     :     :                                               :                    :                 +- InputAdapter [#25, #10, #14, #15, #17, #18, #19, #20]
         :     :     :                                               :                    :                    +- NativeParquetScan  (FileScan parquet [c_customer_sk#25,c_customer_id#10,c_first_name#14,c_last_name#15,c_preferred_cust_flag#17,c_birth_country#18,c_login#19,c_email_address#20] Batched: true, DataFilters: [isnotnull(c_customer_sk#25), isnotnull(c_customer_id#10)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...)
         :     :     :                                               :                    +- NativeSort [ss_customer_sk#26 ASC NULLS FIRST], false
         :     :     :                                               :                       +- InputAdapter
         :     :     :                                               :                          +- AQEShuffleRead coalesced
         :     :     :                                               :                             +- ShuffleQueryStage X
         :     :     :                                               :                                +- NativeShuffleExchange hashpartitioning(ss_customer_sk#26, 100), ENSURE_REQUIREMENTS, [plan_id=5]
         :     :     :                                               :                                   +- NativeFilter (isnotnull(ss_customer_sk#26) AND isnotnull(ss_sold_date_sk#23))
         :     :     :                                               :                                      +- InputAdapter [#23, #26, #12, #11]
         :     :     :                                               :                                         +- NativeParquetScan  (FileScan parquet [ss_sold_date_sk#23,ss_customer_sk#26,ss_ext_discount_amt#12,ss_ext_list_price#11] Batched: true, DataFilters: [isnotnull(ss_customer_sk#26), isnotnull(ss_sold_date_sk#23)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_list_price:...)
         :     :     :                                               +- NativeSort [d_date_sk#24 ASC NULLS FIRST], false
         :     :     :                                                  +- InputAdapter
         :     :     :                                                     +- AQEShuffleRead coalesced
         :     :     :                                                        +- ShuffleQueryStage X
         :     :     :                                                           +- NativeShuffleExchange hashpartitioning(d_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=6]
         :     :     :                                                              +- NativeFilter ((isnotnull(d_year#16) AND (d_year#16 = 2001)) AND isnotnull(d_date_sk#24))
         :     :     :                                                                 +- InputAdapter [#24, #16]
         :     :     :                                                                    +- NativeParquetScan  (FileScan parquet [d_date_sk#24,d_year#16] Batched: true, DataFilters: [isnotnull(d_year#16), (d_year#16 = 2001), isnotnull(d_date_sk#24)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>)
         :     :     +- NativeSort [customer_id#9 ASC NULLS FIRST], false
         :     :        +- InputAdapter
         :     :           +- AQEShuffleRead coalesced
         :     :              +- ShuffleQueryStage X
         :     :                 +- NativeShuffleExchange hashpartitioning(customer_id#9, 100), ENSURE_REQUIREMENTS, [plan_id=7]
         :     :                    +- NativeProject [c_customer_id#27 AS customer_id#9, c_preferred_cust_flag#28 AS customer_preferred_cust_flag#1, MakeDecimal(sum(UnscaledValue((ss_ext_list_price#29 - ss_ext_discount_amt#30)))#13,18,2) AS year_total#7]
         :     :                       +- NativeHashAggregate HashAgg, Vector(c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36), [c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36], [sum(UnscaledValue((ss_ext_list_price#29 - ss_ext_discount_amt#30)))], [sum(UnscaledValue((ss_ext_list_price#29 - ss_ext_discount_amt#30)))#13], 8
         :     :                          +- InputAdapter
         :     :                             +- AQEShuffleRead coalesced
         :     :                                +- ShuffleQueryStage X
         :     :                                   +- NativeShuffleExchange hashpartitioning(c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, 100), ENSURE_REQUIREMENTS, [plan_id=8]
         :     :                                      +- NativeHashAggregate HashAgg, [c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36], [partial_sum(_c8#37)], [sum#38], 0
         :     :                                         +- NativeProject [c_customer_id#27 AS c_customer_id#27, c_first_name#31 AS c_first_name#31, c_last_name#32 AS c_last_name#32, d_year#33 AS d_year#33, c_preferred_cust_flag#28 AS c_preferred_cust_flag#28, c_birth_country#34 AS c_birth_country#34, c_login#35 AS c_login#35, c_email_address#36 AS c_email_address#36, UnscaledValue((ss_ext_list_price#29 - ss_ext_discount_amt#30)) AS _c8#37]
         :     :                                            +- NativeProject [c_customer_id#27, c_first_name#31, c_last_name#32, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, ss_ext_discount_amt#30, ss_ext_list_price#29, d_year#33]
         :     :                                               +- NativeSortMergeJoin [ss_sold_date_sk#39], [d_date_sk#40], Inner
         :     :                                                  :- NativeSort [ss_sold_date_sk#39 ASC NULLS FIRST], false
         :     :                                                  :  +- InputAdapter
         :     :                                                  :     +- InputAdapter [#27, #31, #32, #28, #34, #35, #36, #39, #30, #29]
         :     :                                                  :        +- AQEShuffleRead coalesced
         :     :                                                  :           +- ShuffleQueryStage X
         :     :                                                  :              +- ReusedExchange [c_customer_id#27, c_first_name#31, c_last_name#32, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, ss_sold_date_sk#39, ss_ext_discount_amt#30, ss_ext_list_price#29], NativeShuffleExchange hashpartitioning(ss_sold_date_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=3]
         :     :                                                  +- NativeSort [d_date_sk#40 ASC NULLS FIRST], false
         :     :                                                     +- InputAdapter
         :     :                                                        +- AQEShuffleRead coalesced
         :     :                                                           +- ShuffleQueryStage X
         :     :                                                              +- NativeShuffleExchange hashpartitioning(d_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=9]
         :     :                                                                 +- NativeFilter ((isnotnull(d_year#33) AND (d_year#33 = 2002)) AND isnotnull(d_date_sk#40))
         :     :                                                                    +- InputAdapter [#40, #33]
         :     :                                                                       +- NativeParquetScan  (FileScan parquet [d_date_sk#40,d_year#33] Batched: true, DataFilters: [isnotnull(d_year#33), (d_year#33 = 2002), isnotnull(d_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>)
         :     +- NativeSort [customer_id#8 ASC NULLS FIRST], false
         :        +- InputAdapter
         :           +- AQEShuffleRead coalesced
         :              +- ShuffleQueryStage X
         :                 +- NativeShuffleExchange hashpartitioning(customer_id#8, 100), ENSURE_REQUIREMENTS, [plan_id=10]
         :                    +- NativeFilter (isnotnull(year_total#4) AND (year_total#4 > 0.00))
         :                       +- NativeProject [c_customer_id#41 AS customer_id#8, MakeDecimal(sum(UnscaledValue((ws_ext_list_price#42 - ws_ext_discount_amt#43)))#44,18,2) AS year_total#4]
         :                          +- NativeHashAggregate HashAgg, ArrayBuffer(c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51), [c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51], [sum(UnscaledValue((ws_ext_list_price#42 - ws_ext_discount_amt#43)))], [sum(UnscaledValue((ws_ext_list_price#42 - ws_ext_discount_amt#43)))#44], 8
         :                             +- InputAdapter
         :                                +- AQEShuffleRead coalesced
         :                                   +- ShuffleQueryStage X
         :                                      +- NativeShuffleExchange hashpartitioning(c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51, 100), ENSURE_REQUIREMENTS, [plan_id=11]
         :                                         +- NativeHashAggregate HashAgg, [c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51], [partial_sum(_c8#52)], [sum#53], 0
         :                                            +- NativeProject [c_customer_id#41 AS c_customer_id#41, c_first_name#45 AS c_first_name#45, c_last_name#46 AS c_last_name#46, c_preferred_cust_flag#47 AS c_preferred_cust_flag#47, c_birth_country#48 AS c_birth_country#48, c_login#49 AS c_login#49, c_email_address#50 AS c_email_address#50, d_year#51 AS d_year#51, UnscaledValue((ws_ext_list_price#42 - ws_ext_discount_amt#43)) AS _c8#52]
         :                                               +- NativeProject [c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, ws_ext_discount_amt#43, ws_ext_list_price#42, d_year#51]
         :                                                  +- NativeSortMergeJoin [ws_sold_date_sk#54], [d_date_sk#55], Inner
         :                                                     :- NativeSort [ws_sold_date_sk#54 ASC NULLS FIRST], false
         :                                                     :  +- InputAdapter
         :                                                     :     +- AQEShuffleRead coalesced
         :                                                     :        +- ShuffleQueryStage X
         :                                                     :           +- NativeShuffleExchange hashpartitioning(ws_sold_date_sk#54, 100), ENSURE_REQUIREMENTS, [plan_id=12]
         :                                                     :              +- NativeProject [c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, ws_sold_date_sk#54, ws_ext_discount_amt#43, ws_ext_list_price#42]
         :                                                     :                 +- NativeSortMergeJoin [c_customer_sk#56], [ws_bill_customer_sk#57], Inner
         :                                                     :                    :- NativeSort [c_customer_sk#56 ASC NULLS FIRST], false
         :                                                     :                    :  +- InputAdapter
         :                                                     :                    :     +- InputAdapter [#56, #41, #45, #46, #47, #48, #49, #50]
         :                                                     :                    :        +- AQEShuffleRead coalesced
         :                                                     :                    :           +- ShuffleQueryStage X
         :                                                     :                    :              +- ReusedExchange [c_customer_sk#56, c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50], NativeShuffleExchange hashpartitioning(c_customer_sk#25, 100), ENSURE_REQUIREMENTS, [plan_id=4]
         :                                                     :                    +- NativeSort [ws_bill_customer_sk#57 ASC NULLS FIRST], false
         :                                                     :                       +- InputAdapter
         :                                                     :                          +- AQEShuffleRead coalesced
         :                                                     :                             +- ShuffleQueryStage X
         :                                                     :                                +- NativeShuffleExchange hashpartitioning(ws_bill_customer_sk#57, 100), ENSURE_REQUIREMENTS, [plan_id=13]
         :                                                     :                                   +- NativeFilter (isnotnull(ws_bill_customer_sk#57) AND isnotnull(ws_sold_date_sk#54))
         :                                                     :                                      +- InputAdapter [#54, #57, #43, #42]
         :                                                     :                                         +- NativeParquetScan  (FileScan parquet [ws_sold_date_sk#54,ws_bill_customer_sk#57,ws_ext_discount_amt#43,ws_ext_list_price#42] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#57), isnotnull(ws_sold_date_sk#54)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_list_p...)
         :                                                     +- NativeSort [d_date_sk#55 ASC NULLS FIRST], false
         :                                                        +- InputAdapter
         :                                                           +- InputAdapter [#55, #51]
         :                                                              +- AQEShuffleRead coalesced
         :                                                                 +- ShuffleQueryStage X
         :                                                                    +- ReusedExchange [d_date_sk#55, d_year#51], NativeShuffleExchange hashpartitioning(d_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=6]
         +- NativeSort [customer_id#3 ASC NULLS FIRST], false
            +- InputAdapter
               +- AQEShuffleRead coalesced
                  +- ShuffleQueryStage X
                     +- NativeShuffleExchange hashpartitioning(customer_id#3, 100), ENSURE_REQUIREMENTS, [plan_id=14]
                        +- NativeProject [c_customer_id#58 AS customer_id#3, MakeDecimal(sum(UnscaledValue((ws_ext_list_price#59 - ws_ext_discount_amt#60)))#44,18,2) AS year_total#5]
                           +- NativeHashAggregate HashAgg, ArrayBuffer(c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67), [c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67], [sum(UnscaledValue((ws_ext_list_price#59 - ws_ext_discount_amt#60)))], [sum(UnscaledValue((ws_ext_list_price#59 - ws_ext_discount_amt#60)))#44], 8
                              +- InputAdapter
                                 +- AQEShuffleRead coalesced
                                    +- ShuffleQueryStage X
                                       +- NativeShuffleExchange hashpartitioning(c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67, 100), ENSURE_REQUIREMENTS, [plan_id=15]
                                          +- NativeHashAggregate HashAgg, [c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67], [partial_sum(_c8#68)], [sum#69], 0
                                             +- NativeProject [c_customer_id#58 AS c_customer_id#58, c_first_name#61 AS c_first_name#61, c_last_name#62 AS c_last_name#62, c_preferred_cust_flag#63 AS c_preferred_cust_flag#63, c_birth_country#64 AS c_birth_country#64, c_login#65 AS c_login#65, c_email_address#66 AS c_email_address#66, d_year#67 AS d_year#67, UnscaledValue((ws_ext_list_price#59 - ws_ext_discount_amt#60)) AS _c8#68]
                                                +- NativeProject [c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, ws_ext_discount_amt#60, ws_ext_list_price#59, d_year#67]
                                                   +- NativeSortMergeJoin [ws_sold_date_sk#70], [d_date_sk#71], Inner
                                                      :- NativeSort [ws_sold_date_sk#70 ASC NULLS FIRST], false
                                                      :  +- InputAdapter
                                                      :     +- InputAdapter [#58, #61, #62, #63, #64, #65, #66, #70, #60, #59]
                                                      :        +- AQEShuffleRead coalesced
                                                      :           +- ShuffleQueryStage X
                                                      :              +- ReusedExchange [c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, ws_sold_date_sk#70, ws_ext_discount_amt#60, ws_ext_list_price#59], NativeShuffleExchange hashpartitioning(ws_sold_date_sk#54, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                                                      +- NativeSort [d_date_sk#71 ASC NULLS FIRST], false
                                                         +- InputAdapter
                                                            +- InputAdapter [#71, #67]
                                                               +- AQEShuffleRead coalesced
                                                                  +- ShuffleQueryStage X
                                                                     +- ReusedExchange [d_date_sk#71, d_year#67], NativeShuffleExchange hashpartitioning(d_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=9]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[customer_preferred_cust_flag#1 ASC NULLS FIRST], output=[customer_preferred_cust_flag#1])
   +- Project [customer_preferred_cust_flag#1]
      +- SortMergeJoin [customer_id#2], [customer_id#3], Inner, (CASE WHEN (year_total#4 > 0.00) THEN (year_total#5 / year_total#4) END > CASE WHEN (year_total#6 > 0.00) THEN (year_total#7 / year_total#6) END)
         :- Project [customer_id#2, year_total#6, customer_preferred_cust_flag#1, year_total#7, year_total#4]
         :  +- SortMergeJoin [customer_id#2], [customer_id#8], Inner
         :     :- Project [customer_id#2, year_total#6, customer_preferred_cust_flag#1, year_total#7]
         :     :  +- SortMergeJoin [customer_id#2], [customer_id#9], Inner
         :     :     :- Sort [customer_id#2 ASC NULLS FIRST], false, 0
         :     :     :  +- Exchange hashpartitioning(customer_id#2, 100), ENSURE_REQUIREMENTS, [plan_id=16]
         :     :     :     +- Filter (isnotnull(year_total#6) AND (year_total#6 > 0.00))
         :     :     :        +- HashAggregate(keys=[c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20], functions=[sum(UnscaledValue((ss_ext_list_price#11 - ss_ext_discount_amt#12)))], output=[customer_id#2, year_total#6])
         :     :     :           +- Exchange hashpartitioning(c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, 100), ENSURE_REQUIREMENTS, [plan_id=17]
         :     :     :              +- HashAggregate(keys=[c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20], functions=[partial_sum(UnscaledValue((ss_ext_list_price#11 - ss_ext_discount_amt#12)))], output=[c_customer_id#10, c_first_name#14, c_last_name#15, d_year#16, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, sum#72])
         :     :     :                 +- Project [c_customer_id#10, c_first_name#14, c_last_name#15, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, ss_ext_discount_amt#12, ss_ext_list_price#11, d_year#16]
         :     :     :                    +- SortMergeJoin [ss_sold_date_sk#23], [d_date_sk#24], Inner
         :     :     :                       :- Sort [ss_sold_date_sk#23 ASC NULLS FIRST], false, 0
         :     :     :                       :  +- Exchange hashpartitioning(ss_sold_date_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=18]
         :     :     :                       :     +- Project [c_customer_id#10, c_first_name#14, c_last_name#15, c_preferred_cust_flag#17, c_birth_country#18, c_login#19, c_email_address#20, ss_sold_date_sk#23, ss_ext_discount_amt#12, ss_ext_list_price#11]
         :     :     :                       :        +- SortMergeJoin [c_customer_sk#25], [ss_customer_sk#26], Inner
         :     :     :                       :           :- Sort [c_customer_sk#25 ASC NULLS FIRST], false, 0
         :     :     :                       :           :  +- Exchange hashpartitioning(c_customer_sk#25, 100), ENSURE_REQUIREMENTS, [plan_id=19]
         :     :     :                       :           :     +- Filter (isnotnull(c_customer_sk#25) AND isnotnull(c_customer_id#10))
         :     :     :                       :           :        +- FileScan parquet [c_customer_sk#25,c_customer_id#10,c_first_name#14,c_last_name#15,c_preferred_cust_flag#17,c_birth_country#18,c_login#19,c_email_address#20] Batched: true, DataFilters: [isnotnull(c_customer_sk#25), isnotnull(c_customer_id#10)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...
         :     :     :                       :           +- Sort [ss_customer_sk#26 ASC NULLS FIRST], false, 0
         :     :     :                       :              +- Exchange hashpartitioning(ss_customer_sk#26, 100), ENSURE_REQUIREMENTS, [plan_id=20]
         :     :     :                       :                 +- Filter (isnotnull(ss_customer_sk#26) AND isnotnull(ss_sold_date_sk#23))
         :     :     :                       :                    +- FileScan parquet [ss_sold_date_sk#23,ss_customer_sk#26,ss_ext_discount_amt#12,ss_ext_list_price#11] Batched: true, DataFilters: [isnotnull(ss_customer_sk#26), isnotnull(ss_sold_date_sk#23)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_list_price:...
         :     :     :                       +- Sort [d_date_sk#24 ASC NULLS FIRST], false, 0
         :     :     :                          +- Exchange hashpartitioning(d_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=21]
         :     :     :                             +- Filter ((isnotnull(d_year#16) AND (d_year#16 = 2001)) AND isnotnull(d_date_sk#24))
         :     :     :                                +- FileScan parquet [d_date_sk#24,d_year#16] Batched: true, DataFilters: [isnotnull(d_year#16), (d_year#16 = 2001), isnotnull(d_date_sk#24)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
         :     :     +- Sort [customer_id#9 ASC NULLS FIRST], false, 0
         :     :        +- Exchange hashpartitioning(customer_id#9, 100), ENSURE_REQUIREMENTS, [plan_id=22]
         :     :           +- HashAggregate(keys=[c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36], functions=[sum(UnscaledValue((ss_ext_list_price#29 - ss_ext_discount_amt#30)))], output=[customer_id#9, customer_preferred_cust_flag#1, year_total#7])
         :     :              +- Exchange hashpartitioning(c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, 100), ENSURE_REQUIREMENTS, [plan_id=23]
         :     :                 +- HashAggregate(keys=[c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36], functions=[partial_sum(UnscaledValue((ss_ext_list_price#29 - ss_ext_discount_amt#30)))], output=[c_customer_id#27, c_first_name#31, c_last_name#32, d_year#33, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, sum#73])
         :     :                    +- Project [c_customer_id#27, c_first_name#31, c_last_name#32, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, ss_ext_discount_amt#30, ss_ext_list_price#29, d_year#33]
         :     :                       +- SortMergeJoin [ss_sold_date_sk#39], [d_date_sk#40], Inner
         :     :                          :- Sort [ss_sold_date_sk#39 ASC NULLS FIRST], false, 0
         :     :                          :  +- Exchange hashpartitioning(ss_sold_date_sk#39, 100), ENSURE_REQUIREMENTS, [plan_id=24]
         :     :                          :     +- Project [c_customer_id#27, c_first_name#31, c_last_name#32, c_preferred_cust_flag#28, c_birth_country#34, c_login#35, c_email_address#36, ss_sold_date_sk#39, ss_ext_discount_amt#30, ss_ext_list_price#29]
         :     :                          :        +- SortMergeJoin [c_customer_sk#74], [ss_customer_sk#75], Inner
         :     :                          :           :- Sort [c_customer_sk#74 ASC NULLS FIRST], false, 0
         :     :                          :           :  +- Exchange hashpartitioning(c_customer_sk#74, 100), ENSURE_REQUIREMENTS, [plan_id=25]
         :     :                          :           :     +- Filter (isnotnull(c_customer_sk#74) AND isnotnull(c_customer_id#27))
         :     :                          :           :        +- FileScan parquet [c_customer_sk#74,c_customer_id#27,c_first_name#31,c_last_name#32,c_preferred_cust_flag#28,c_birth_country#34,c_login#35,c_email_address#36] Batched: true, DataFilters: [isnotnull(c_customer_sk#74), isnotnull(c_customer_id#27)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...
         :     :                          :           +- Sort [ss_customer_sk#75 ASC NULLS FIRST], false, 0
         :     :                          :              +- Exchange hashpartitioning(ss_customer_sk#75, 100), ENSURE_REQUIREMENTS, [plan_id=26]
         :     :                          :                 +- Filter (isnotnull(ss_customer_sk#75) AND isnotnull(ss_sold_date_sk#39))
         :     :                          :                    +- FileScan parquet [ss_sold_date_sk#39,ss_customer_sk#75,ss_ext_discount_amt#30,ss_ext_list_price#29] Batched: true, DataFilters: [isnotnull(ss_customer_sk#75), isnotnull(ss_sold_date_sk#39)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_list_price:...
         :     :                          +- Sort [d_date_sk#40 ASC NULLS FIRST], false, 0
         :     :                             +- Exchange hashpartitioning(d_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=27]
         :     :                                +- Filter ((isnotnull(d_year#33) AND (d_year#33 = 2002)) AND isnotnull(d_date_sk#40))
         :     :                                   +- FileScan parquet [d_date_sk#40,d_year#33] Batched: true, DataFilters: [isnotnull(d_year#33), (d_year#33 = 2002), isnotnull(d_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
         :     +- Sort [customer_id#8 ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(customer_id#8, 100), ENSURE_REQUIREMENTS, [plan_id=28]
         :           +- Filter (isnotnull(year_total#4) AND (year_total#4 > 0.00))
         :              +- HashAggregate(keys=[c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51], functions=[sum(UnscaledValue((ws_ext_list_price#42 - ws_ext_discount_amt#43)))], output=[customer_id#8, year_total#4])
         :                 +- Exchange hashpartitioning(c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51, 100), ENSURE_REQUIREMENTS, [plan_id=29]
         :                    +- HashAggregate(keys=[c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51], functions=[partial_sum(UnscaledValue((ws_ext_list_price#42 - ws_ext_discount_amt#43)))], output=[c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, d_year#51, sum#76])
         :                       +- Project [c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, ws_ext_discount_amt#43, ws_ext_list_price#42, d_year#51]
         :                          +- SortMergeJoin [ws_sold_date_sk#54], [d_date_sk#55], Inner
         :                             :- Sort [ws_sold_date_sk#54 ASC NULLS FIRST], false, 0
         :                             :  +- Exchange hashpartitioning(ws_sold_date_sk#54, 100), ENSURE_REQUIREMENTS, [plan_id=30]
         :                             :     +- Project [c_customer_id#41, c_first_name#45, c_last_name#46, c_preferred_cust_flag#47, c_birth_country#48, c_login#49, c_email_address#50, ws_sold_date_sk#54, ws_ext_discount_amt#43, ws_ext_list_price#42]
         :                             :        +- SortMergeJoin [c_customer_sk#56], [ws_bill_customer_sk#57], Inner
         :                             :           :- Sort [c_customer_sk#56 ASC NULLS FIRST], false, 0
         :                             :           :  +- Exchange hashpartitioning(c_customer_sk#56, 100), ENSURE_REQUIREMENTS, [plan_id=31]
         :                             :           :     +- Filter (isnotnull(c_customer_sk#56) AND isnotnull(c_customer_id#41))
         :                             :           :        +- FileScan parquet [c_customer_sk#56,c_customer_id#41,c_first_name#45,c_last_name#46,c_preferred_cust_flag#47,c_birth_country#48,c_login#49,c_email_address#50] Batched: true, DataFilters: [isnotnull(c_customer_sk#56), isnotnull(c_customer_id#41)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...
         :                             :           +- Sort [ws_bill_customer_sk#57 ASC NULLS FIRST], false, 0
         :                             :              +- Exchange hashpartitioning(ws_bill_customer_sk#57, 100), ENSURE_REQUIREMENTS, [plan_id=32]
         :                             :                 +- Filter (isnotnull(ws_bill_customer_sk#57) AND isnotnull(ws_sold_date_sk#54))
         :                             :                    +- FileScan parquet [ws_sold_date_sk#54,ws_bill_customer_sk#57,ws_ext_discount_amt#43,ws_ext_list_price#42] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#57), isnotnull(ws_sold_date_sk#54)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_list_p...
         :                             +- Sort [d_date_sk#55 ASC NULLS FIRST], false, 0
         :                                +- Exchange hashpartitioning(d_date_sk#55, 100), ENSURE_REQUIREMENTS, [plan_id=33]
         :                                   +- Filter ((isnotnull(d_year#51) AND (d_year#51 = 2001)) AND isnotnull(d_date_sk#55))
         :                                      +- FileScan parquet [d_date_sk#55,d_year#51] Batched: true, DataFilters: [isnotnull(d_year#51), (d_year#51 = 2001), isnotnull(d_date_sk#55)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
         +- Sort [customer_id#3 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(customer_id#3, 100), ENSURE_REQUIREMENTS, [plan_id=34]
               +- HashAggregate(keys=[c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67], functions=[sum(UnscaledValue((ws_ext_list_price#59 - ws_ext_discount_amt#60)))], output=[customer_id#3, year_total#5])
                  +- Exchange hashpartitioning(c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67, 100), ENSURE_REQUIREMENTS, [plan_id=35]
                     +- HashAggregate(keys=[c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67], functions=[partial_sum(UnscaledValue((ws_ext_list_price#59 - ws_ext_discount_amt#60)))], output=[c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, d_year#67, sum#77])
                        +- Project [c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, ws_ext_discount_amt#60, ws_ext_list_price#59, d_year#67]
                           +- SortMergeJoin [ws_sold_date_sk#70], [d_date_sk#71], Inner
                              :- Sort [ws_sold_date_sk#70 ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_sold_date_sk#70, 100), ENSURE_REQUIREMENTS, [plan_id=36]
                              :     +- Project [c_customer_id#58, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66, ws_sold_date_sk#70, ws_ext_discount_amt#60, ws_ext_list_price#59]
                              :        +- SortMergeJoin [c_customer_sk#78], [ws_bill_customer_sk#79], Inner
                              :           :- Sort [c_customer_sk#78 ASC NULLS FIRST], false, 0
                              :           :  +- Exchange hashpartitioning(c_customer_sk#78, 100), ENSURE_REQUIREMENTS, [plan_id=37]
                              :           :     +- Filter (isnotnull(c_customer_sk#78) AND isnotnull(c_customer_id#58))
                              :           :        +- FileScan parquet [c_customer_sk#78,c_customer_id#58,c_first_name#61,c_last_name#62,c_preferred_cust_flag#63,c_birth_country#64,c_login#65,c_email_address#66] Batched: true, DataFilters: [isnotnull(c_customer_sk#78), isnotnull(c_customer_id#58)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...
                              :           +- Sort [ws_bill_customer_sk#79 ASC NULLS FIRST], false, 0
                              :              +- Exchange hashpartitioning(ws_bill_customer_sk#79, 100), ENSURE_REQUIREMENTS, [plan_id=38]
                              :                 +- Filter (isnotnull(ws_bill_customer_sk#79) AND isnotnull(ws_sold_date_sk#70))
                              :                    +- FileScan parquet [ws_sold_date_sk#70,ws_bill_customer_sk#79,ws_ext_discount_amt#60,ws_ext_list_price#59] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#79), isnotnull(ws_sold_date_sk#70)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_list_p...
                              +- Sort [d_date_sk#71 ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(d_date_sk#71, 100), ENSURE_REQUIREMENTS, [plan_id=39]
                                    +- Filter ((isnotnull(d_year#67) AND (d_year#67 = 2002)) AND isnotnull(d_date_sk#71))
                                       +- FileScan parquet [d_date_sk#71,d_year#67] Batched: true, DataFilters: [isnotnull(d_year#67), (d_year#67 = 2002), isnotnull(d_date_sk#71)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
