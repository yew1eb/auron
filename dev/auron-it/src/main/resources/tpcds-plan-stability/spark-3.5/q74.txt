AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[customer_id#1 ASC NULLS FIRST,customer_id#1 ASC NULLS FIRST,customer_id#1 ASC NULLS FIRST], output=[customer_id#1,customer_first_name#2,customer_last_name#3])
   +- *(1) Project [customer_id#1, customer_first_name#2, customer_last_name#3]
      +- *(1) SortMergeJoin [customer_id#4], [customer_id#5], Inner, (CASE WHEN (year_total#6 > 0.00) THEN (year_total#7 / year_total#6) END > CASE WHEN (year_total#8 > 0.00) THEN (year_total#9 / year_total#8) END)
         :- NativeProject [customer_id#4, year_total#8, customer_id#1, customer_first_name#2, customer_last_name#3, year_total#9, year_total#6]
         :  +- NativeSortMergeJoin [customer_id#4], [customer_id#10], Inner
         :     :- NativeSortMergeJoin [customer_id#4], [customer_id#1], Inner
         :     :  :- NativeSort [customer_id#4 ASC NULLS FIRST], false
         :     :  :  +- InputAdapter
         :     :  :     +- AQEShuffleRead coalesced
         :     :  :        +- ShuffleQueryStage X
         :     :  :           +- NativeShuffleExchange hashpartitioning(customer_id#4, 100), ENSURE_REQUIREMENTS, [plan_id=1]
         :     :  :              +- NativeFilter (isnotnull(year_total#8) AND (year_total#8 > 0.00))
         :     :  :                 +- NativeProject [c_customer_id#11 AS customer_id#4, MakeDecimal(sum(UnscaledValue(ss_net_paid#12))#13,17,2) AS year_total#8]
         :     :  :                    +- NativeHashAggregate HashAgg, ArrayBuffer(c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16), [c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16], [sum(UnscaledValue(ss_net_paid#12))], [sum(UnscaledValue(ss_net_paid#12))#13], 4
         :     :  :                       +- InputAdapter
         :     :  :                          +- AQEShuffleRead coalesced
         :     :  :                             +- ShuffleQueryStage X
         :     :  :                                +- NativeShuffleExchange hashpartitioning(c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16, 100), ENSURE_REQUIREMENTS, [plan_id=2]
         :     :  :                                   +- NativeHashAggregate HashAgg, [c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16], [partial_sum(_c4#17)], [sum#18], 0
         :     :  :                                      +- NativeProject [c_customer_id#11 AS c_customer_id#11, c_first_name#14 AS c_first_name#14, c_last_name#15 AS c_last_name#15, d_year#16 AS d_year#16, UnscaledValue(ss_net_paid#12) AS _c4#17]
         :     :  :                                         +- NativeProject [c_customer_id#11, c_first_name#14, c_last_name#15, ss_net_paid#12, d_year#16]
         :     :  :                                            +- NativeSortMergeJoin [ss_sold_date_sk#19], [d_date_sk#20], Inner
         :     :  :                                               :- NativeSort [ss_sold_date_sk#19 ASC NULLS FIRST], false
         :     :  :                                               :  +- InputAdapter
         :     :  :                                               :     +- AQEShuffleRead coalesced
         :     :  :                                               :        +- ShuffleQueryStage X
         :     :  :                                               :           +- NativeShuffleExchange hashpartitioning(ss_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=3]
         :     :  :                                               :              +- NativeProject [c_customer_id#11, c_first_name#14, c_last_name#15, ss_sold_date_sk#19, ss_net_paid#12]
         :     :  :                                               :                 +- NativeSortMergeJoin [c_customer_sk#21], [ss_customer_sk#22], Inner
         :     :  :                                               :                    :- NativeSort [c_customer_sk#21 ASC NULLS FIRST], false
         :     :  :                                               :                    :  +- InputAdapter
         :     :  :                                               :                    :     +- AQEShuffleRead coalesced
         :     :  :                                               :                    :        +- ShuffleQueryStage X
         :     :  :                                               :                    :           +- NativeShuffleExchange hashpartitioning(c_customer_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=4]
         :     :  :                                               :                    :              +- NativeFilter (isnotnull(c_customer_sk#21) AND isnotnull(c_customer_id#11))
         :     :  :                                               :                    :                 +- InputAdapter [#21, #11, #14, #15]
         :     :  :                                               :                    :                    +- NativeParquetScan  (FileScan parquet [c_customer_sk#21,c_customer_id#11,c_first_name#14,c_last_name#15] Batched: true, DataFilters: [isnotnull(c_customer_sk#21), isnotnull(c_customer_id#11)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string>)
         :     :  :                                               :                    +- NativeSort [ss_customer_sk#22 ASC NULLS FIRST], false
         :     :  :                                               :                       +- InputAdapter
         :     :  :                                               :                          +- AQEShuffleRead coalesced
         :     :  :                                               :                             +- ShuffleQueryStage X
         :     :  :                                               :                                +- NativeShuffleExchange hashpartitioning(ss_customer_sk#22, 100), ENSURE_REQUIREMENTS, [plan_id=5]
         :     :  :                                               :                                   +- NativeFilter (isnotnull(ss_customer_sk#22) AND isnotnull(ss_sold_date_sk#19))
         :     :  :                                               :                                      +- InputAdapter [#19, #22, #12]
         :     :  :                                               :                                         +- NativeParquetScan  (FileScan parquet [ss_sold_date_sk#19,ss_customer_sk#22,ss_net_paid#12] Batched: true, DataFilters: [isnotnull(ss_customer_sk#22), isnotnull(ss_sold_date_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_net_paid:decimal(7,2)>)
         :     :  :                                               +- NativeSort [d_date_sk#20 ASC NULLS FIRST], false
         :     :  :                                                  +- InputAdapter
         :     :  :                                                     +- AQEShuffleRead coalesced
         :     :  :                                                        +- ShuffleQueryStage X
         :     :  :                                                           +- NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=6]
         :     :  :                                                              +- NativeFilter (((isnotnull(d_year#16) AND (d_year#16 = 2001)) AND d_year#16 IN (2001,2002)) AND isnotnull(d_date_sk#20))
         :     :  :                                                                 +- InputAdapter [#20, #16]
         :     :  :                                                                    +- NativeParquetScan  (FileScan parquet [d_date_sk#20,d_year#16] Batched: true, DataFilters: [isnotnull(d_year#16), (d_year#16 = 2001), d_year#16 IN (2001,2002), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>)
         :     :  +- NativeSort [customer_id#1 ASC NULLS FIRST], false
         :     :     +- InputAdapter
         :     :        +- AQEShuffleRead coalesced
         :     :           +- ShuffleQueryStage X
         :     :              +- NativeShuffleExchange hashpartitioning(customer_id#1, 100), ENSURE_REQUIREMENTS, [plan_id=7]
         :     :                 +- NativeProject [c_customer_id#23 AS customer_id#1, c_first_name#24 AS customer_first_name#2, c_last_name#25 AS customer_last_name#3, MakeDecimal(sum(UnscaledValue(ss_net_paid#26))#13,17,2) AS year_total#9]
         :     :                    +- NativeHashAggregate HashAgg, ArrayBuffer(c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27), [c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27], [sum(UnscaledValue(ss_net_paid#26))], [sum(UnscaledValue(ss_net_paid#26))#13], 4
         :     :                       +- InputAdapter
         :     :                          +- AQEShuffleRead coalesced
         :     :                             +- ShuffleQueryStage X
         :     :                                +- NativeShuffleExchange hashpartitioning(c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27, 100), ENSURE_REQUIREMENTS, [plan_id=8]
         :     :                                   +- NativeHashAggregate HashAgg, [c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27], [partial_sum(_c4#28)], [sum#29], 0
         :     :                                      +- NativeProject [c_customer_id#23 AS c_customer_id#23, c_first_name#24 AS c_first_name#24, c_last_name#25 AS c_last_name#25, d_year#27 AS d_year#27, UnscaledValue(ss_net_paid#26) AS _c4#28]
         :     :                                         +- NativeProject [c_customer_id#23, c_first_name#24, c_last_name#25, ss_net_paid#26, d_year#27]
         :     :                                            +- NativeSortMergeJoin [ss_sold_date_sk#30], [d_date_sk#31], Inner
         :     :                                               :- NativeSort [ss_sold_date_sk#30 ASC NULLS FIRST], false
         :     :                                               :  +- InputAdapter
         :     :                                               :     +- InputAdapter [#23, #24, #25, #30, #26]
         :     :                                               :        +- AQEShuffleRead coalesced
         :     :                                               :           +- ShuffleQueryStage X
         :     :                                               :              +- ReusedExchange [c_customer_id#23, c_first_name#24, c_last_name#25, ss_sold_date_sk#30, ss_net_paid#26], NativeShuffleExchange hashpartitioning(ss_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=3]
         :     :                                               +- NativeSort [d_date_sk#31 ASC NULLS FIRST], false
         :     :                                                  +- InputAdapter
         :     :                                                     +- AQEShuffleRead coalesced
         :     :                                                        +- ShuffleQueryStage X
         :     :                                                           +- NativeShuffleExchange hashpartitioning(d_date_sk#31, 100), ENSURE_REQUIREMENTS, [plan_id=9]
         :     :                                                              +- NativeFilter (((isnotnull(d_year#27) AND (d_year#27 = 2002)) AND d_year#27 IN (2001,2002)) AND isnotnull(d_date_sk#31))
         :     :                                                                 +- InputAdapter [#31, #27]
         :     :                                                                    +- NativeParquetScan  (FileScan parquet [d_date_sk#31,d_year#27] Batched: true, DataFilters: [isnotnull(d_year#27), (d_year#27 = 2002), d_year#27 IN (2001,2002), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>)
         :     +- NativeSort [customer_id#10 ASC NULLS FIRST], false
         :        +- InputAdapter
         :           +- AQEShuffleRead coalesced
         :              +- ShuffleQueryStage X
         :                 +- NativeShuffleExchange hashpartitioning(customer_id#10, 100), ENSURE_REQUIREMENTS, [plan_id=10]
         :                    +- NativeFilter (isnotnull(year_total#6) AND (year_total#6 > 0.00))
         :                       +- NativeProject [c_customer_id#32 AS customer_id#10, MakeDecimal(sum(UnscaledValue(ws_net_paid#33))#34,17,2) AS year_total#6]
         :                          +- NativeHashAggregate HashAgg, ArrayBuffer(c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37), [c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37], [sum(UnscaledValue(ws_net_paid#33))], [sum(UnscaledValue(ws_net_paid#33))#34], 4
         :                             +- InputAdapter
         :                                +- AQEShuffleRead coalesced
         :                                   +- ShuffleQueryStage X
         :                                      +- NativeShuffleExchange hashpartitioning(c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37, 100), ENSURE_REQUIREMENTS, [plan_id=11]
         :                                         +- NativeHashAggregate HashAgg, [c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37], [partial_sum(_c4#38)], [sum#39], 0
         :                                            +- NativeProject [c_customer_id#32 AS c_customer_id#32, c_first_name#35 AS c_first_name#35, c_last_name#36 AS c_last_name#36, d_year#37 AS d_year#37, UnscaledValue(ws_net_paid#33) AS _c4#38]
         :                                               +- NativeProject [c_customer_id#32, c_first_name#35, c_last_name#36, ws_net_paid#33, d_year#37]
         :                                                  +- NativeSortMergeJoin [ws_sold_date_sk#40], [d_date_sk#41], Inner
         :                                                     :- NativeSort [ws_sold_date_sk#40 ASC NULLS FIRST], false
         :                                                     :  +- InputAdapter
         :                                                     :     +- AQEShuffleRead coalesced
         :                                                     :        +- ShuffleQueryStage X
         :                                                     :           +- NativeShuffleExchange hashpartitioning(ws_sold_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=12]
         :                                                     :              +- NativeProject [c_customer_id#32, c_first_name#35, c_last_name#36, ws_sold_date_sk#40, ws_net_paid#33]
         :                                                     :                 +- NativeSortMergeJoin [c_customer_sk#42], [ws_bill_customer_sk#43], Inner
         :                                                     :                    :- NativeSort [c_customer_sk#42 ASC NULLS FIRST], false
         :                                                     :                    :  +- InputAdapter
         :                                                     :                    :     +- InputAdapter [#42, #32, #35, #36]
         :                                                     :                    :        +- AQEShuffleRead coalesced
         :                                                     :                    :           +- ShuffleQueryStage X
         :                                                     :                    :              +- ReusedExchange [c_customer_sk#42, c_customer_id#32, c_first_name#35, c_last_name#36], NativeShuffleExchange hashpartitioning(c_customer_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=4]
         :                                                     :                    +- NativeSort [ws_bill_customer_sk#43 ASC NULLS FIRST], false
         :                                                     :                       +- InputAdapter
         :                                                     :                          +- AQEShuffleRead coalesced
         :                                                     :                             +- ShuffleQueryStage X
         :                                                     :                                +- NativeShuffleExchange hashpartitioning(ws_bill_customer_sk#43, 100), ENSURE_REQUIREMENTS, [plan_id=13]
         :                                                     :                                   +- NativeFilter (isnotnull(ws_bill_customer_sk#43) AND isnotnull(ws_sold_date_sk#40))
         :                                                     :                                      +- InputAdapter [#40, #43, #33]
         :                                                     :                                         +- NativeParquetScan  (FileScan parquet [ws_sold_date_sk#40,ws_bill_customer_sk#43,ws_net_paid#33] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#43), isnotnull(ws_sold_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_net_paid:decimal(7,2)>)
         :                                                     +- NativeSort [d_date_sk#41 ASC NULLS FIRST], false
         :                                                        +- InputAdapter
         :                                                           +- InputAdapter [#41, #37]
         :                                                              +- AQEShuffleRead coalesced
         :                                                                 +- ShuffleQueryStage X
         :                                                                    +- ReusedExchange [d_date_sk#41, d_year#37], NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=6]
         +- NativeSort [customer_id#5 ASC NULLS FIRST], false
            +- InputAdapter
               +- AQEShuffleRead coalesced
                  +- ShuffleQueryStage X
                     +- NativeShuffleExchange hashpartitioning(customer_id#5, 100), ENSURE_REQUIREMENTS, [plan_id=14]
                        +- NativeProject [c_customer_id#44 AS customer_id#5, MakeDecimal(sum(UnscaledValue(ws_net_paid#45))#34,17,2) AS year_total#7]
                           +- NativeHashAggregate HashAgg, ArrayBuffer(c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48), [c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48], [sum(UnscaledValue(ws_net_paid#45))], [sum(UnscaledValue(ws_net_paid#45))#34], 4
                              +- InputAdapter
                                 +- AQEShuffleRead coalesced
                                    +- ShuffleQueryStage X
                                       +- NativeShuffleExchange hashpartitioning(c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48, 100), ENSURE_REQUIREMENTS, [plan_id=15]
                                          +- NativeHashAggregate HashAgg, [c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48], [partial_sum(_c4#49)], [sum#50], 0
                                             +- NativeProject [c_customer_id#44 AS c_customer_id#44, c_first_name#46 AS c_first_name#46, c_last_name#47 AS c_last_name#47, d_year#48 AS d_year#48, UnscaledValue(ws_net_paid#45) AS _c4#49]
                                                +- NativeProject [c_customer_id#44, c_first_name#46, c_last_name#47, ws_net_paid#45, d_year#48]
                                                   +- NativeSortMergeJoin [ws_sold_date_sk#51], [d_date_sk#52], Inner
                                                      :- NativeSort [ws_sold_date_sk#51 ASC NULLS FIRST], false
                                                      :  +- InputAdapter
                                                      :     +- InputAdapter [#44, #46, #47, #51, #45]
                                                      :        +- AQEShuffleRead coalesced
                                                      :           +- ShuffleQueryStage X
                                                      :              +- ReusedExchange [c_customer_id#44, c_first_name#46, c_last_name#47, ws_sold_date_sk#51, ws_net_paid#45], NativeShuffleExchange hashpartitioning(ws_sold_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                                                      +- NativeSort [d_date_sk#52 ASC NULLS FIRST], false
                                                         +- InputAdapter
                                                            +- InputAdapter [#52, #48]
                                                               +- AQEShuffleRead coalesced
                                                                  +- ShuffleQueryStage X
                                                                     +- ReusedExchange [d_date_sk#52, d_year#48], NativeShuffleExchange hashpartitioning(d_date_sk#31, 100), ENSURE_REQUIREMENTS, [plan_id=9]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[customer_id#1 ASC NULLS FIRST,customer_id#1 ASC NULLS FIRST,customer_id#1 ASC NULLS FIRST], output=[customer_id#1,customer_first_name#2,customer_last_name#3])
   +- Project [customer_id#1, customer_first_name#2, customer_last_name#3]
      +- SortMergeJoin [customer_id#4], [customer_id#5], Inner, (CASE WHEN (year_total#6 > 0.00) THEN (year_total#7 / year_total#6) END > CASE WHEN (year_total#8 > 0.00) THEN (year_total#9 / year_total#8) END)
         :- Project [customer_id#4, year_total#8, customer_id#1, customer_first_name#2, customer_last_name#3, year_total#9, year_total#6]
         :  +- SortMergeJoin [customer_id#4], [customer_id#10], Inner
         :     :- SortMergeJoin [customer_id#4], [customer_id#1], Inner
         :     :  :- Sort [customer_id#4 ASC NULLS FIRST], false, 0
         :     :  :  +- Exchange hashpartitioning(customer_id#4, 100), ENSURE_REQUIREMENTS, [plan_id=16]
         :     :  :     +- Filter (isnotnull(year_total#8) AND (year_total#8 > 0.00))
         :     :  :        +- HashAggregate(keys=[c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16], functions=[sum(UnscaledValue(ss_net_paid#12))], output=[customer_id#4, year_total#8])
         :     :  :           +- Exchange hashpartitioning(c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16, 100), ENSURE_REQUIREMENTS, [plan_id=17]
         :     :  :              +- HashAggregate(keys=[c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16], functions=[partial_sum(UnscaledValue(ss_net_paid#12))], output=[c_customer_id#11, c_first_name#14, c_last_name#15, d_year#16, sum#53])
         :     :  :                 +- Project [c_customer_id#11, c_first_name#14, c_last_name#15, ss_net_paid#12, d_year#16]
         :     :  :                    +- SortMergeJoin [ss_sold_date_sk#19], [d_date_sk#20], Inner
         :     :  :                       :- Sort [ss_sold_date_sk#19 ASC NULLS FIRST], false, 0
         :     :  :                       :  +- Exchange hashpartitioning(ss_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=18]
         :     :  :                       :     +- Project [c_customer_id#11, c_first_name#14, c_last_name#15, ss_sold_date_sk#19, ss_net_paid#12]
         :     :  :                       :        +- SortMergeJoin [c_customer_sk#21], [ss_customer_sk#22], Inner
         :     :  :                       :           :- Sort [c_customer_sk#21 ASC NULLS FIRST], false, 0
         :     :  :                       :           :  +- Exchange hashpartitioning(c_customer_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=19]
         :     :  :                       :           :     +- Filter (isnotnull(c_customer_sk#21) AND isnotnull(c_customer_id#11))
         :     :  :                       :           :        +- FileScan parquet [c_customer_sk#21,c_customer_id#11,c_first_name#14,c_last_name#15] Batched: true, DataFilters: [isnotnull(c_customer_sk#21), isnotnull(c_customer_id#11)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string>
         :     :  :                       :           +- Sort [ss_customer_sk#22 ASC NULLS FIRST], false, 0
         :     :  :                       :              +- Exchange hashpartitioning(ss_customer_sk#22, 100), ENSURE_REQUIREMENTS, [plan_id=20]
         :     :  :                       :                 +- Filter (isnotnull(ss_customer_sk#22) AND isnotnull(ss_sold_date_sk#19))
         :     :  :                       :                    +- FileScan parquet [ss_sold_date_sk#19,ss_customer_sk#22,ss_net_paid#12] Batched: true, DataFilters: [isnotnull(ss_customer_sk#22), isnotnull(ss_sold_date_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_net_paid:decimal(7,2)>
         :     :  :                       +- Sort [d_date_sk#20 ASC NULLS FIRST], false, 0
         :     :  :                          +- Exchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=21]
         :     :  :                             +- Filter (((isnotnull(d_year#16) AND (d_year#16 = 2001)) AND d_year#16 IN (2001,2002)) AND isnotnull(d_date_sk#20))
         :     :  :                                +- FileScan parquet [d_date_sk#20,d_year#16] Batched: true, DataFilters: [isnotnull(d_year#16), (d_year#16 = 2001), d_year#16 IN (2001,2002), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
         :     :  +- Sort [customer_id#1 ASC NULLS FIRST], false, 0
         :     :     +- Exchange hashpartitioning(customer_id#1, 100), ENSURE_REQUIREMENTS, [plan_id=22]
         :     :        +- HashAggregate(keys=[c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27], functions=[sum(UnscaledValue(ss_net_paid#26))], output=[customer_id#1, customer_first_name#2, customer_last_name#3, year_total#9])
         :     :           +- Exchange hashpartitioning(c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27, 100), ENSURE_REQUIREMENTS, [plan_id=23]
         :     :              +- HashAggregate(keys=[c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27], functions=[partial_sum(UnscaledValue(ss_net_paid#26))], output=[c_customer_id#23, c_first_name#24, c_last_name#25, d_year#27, sum#54])
         :     :                 +- Project [c_customer_id#23, c_first_name#24, c_last_name#25, ss_net_paid#26, d_year#27]
         :     :                    +- SortMergeJoin [ss_sold_date_sk#30], [d_date_sk#31], Inner
         :     :                       :- Sort [ss_sold_date_sk#30 ASC NULLS FIRST], false, 0
         :     :                       :  +- Exchange hashpartitioning(ss_sold_date_sk#30, 100), ENSURE_REQUIREMENTS, [plan_id=24]
         :     :                       :     +- Project [c_customer_id#23, c_first_name#24, c_last_name#25, ss_sold_date_sk#30, ss_net_paid#26]
         :     :                       :        +- SortMergeJoin [c_customer_sk#55], [ss_customer_sk#56], Inner
         :     :                       :           :- Sort [c_customer_sk#55 ASC NULLS FIRST], false, 0
         :     :                       :           :  +- Exchange hashpartitioning(c_customer_sk#55, 100), ENSURE_REQUIREMENTS, [plan_id=25]
         :     :                       :           :     +- Filter (isnotnull(c_customer_sk#55) AND isnotnull(c_customer_id#23))
         :     :                       :           :        +- FileScan parquet [c_customer_sk#55,c_customer_id#23,c_first_name#24,c_last_name#25] Batched: true, DataFilters: [isnotnull(c_customer_sk#55), isnotnull(c_customer_id#23)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string>
         :     :                       :           +- Sort [ss_customer_sk#56 ASC NULLS FIRST], false, 0
         :     :                       :              +- Exchange hashpartitioning(ss_customer_sk#56, 100), ENSURE_REQUIREMENTS, [plan_id=26]
         :     :                       :                 +- Filter (isnotnull(ss_customer_sk#56) AND isnotnull(ss_sold_date_sk#30))
         :     :                       :                    +- FileScan parquet [ss_sold_date_sk#30,ss_customer_sk#56,ss_net_paid#26] Batched: true, DataFilters: [isnotnull(ss_customer_sk#56), isnotnull(ss_sold_date_sk#30)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_net_paid:decimal(7,2)>
         :     :                       +- Sort [d_date_sk#31 ASC NULLS FIRST], false, 0
         :     :                          +- Exchange hashpartitioning(d_date_sk#31, 100), ENSURE_REQUIREMENTS, [plan_id=27]
         :     :                             +- Filter (((isnotnull(d_year#27) AND (d_year#27 = 2002)) AND d_year#27 IN (2001,2002)) AND isnotnull(d_date_sk#31))
         :     :                                +- FileScan parquet [d_date_sk#31,d_year#27] Batched: true, DataFilters: [isnotnull(d_year#27), (d_year#27 = 2002), d_year#27 IN (2001,2002), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
         :     +- Sort [customer_id#10 ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(customer_id#10, 100), ENSURE_REQUIREMENTS, [plan_id=28]
         :           +- Filter (isnotnull(year_total#6) AND (year_total#6 > 0.00))
         :              +- HashAggregate(keys=[c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37], functions=[sum(UnscaledValue(ws_net_paid#33))], output=[customer_id#10, year_total#6])
         :                 +- Exchange hashpartitioning(c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37, 100), ENSURE_REQUIREMENTS, [plan_id=29]
         :                    +- HashAggregate(keys=[c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37], functions=[partial_sum(UnscaledValue(ws_net_paid#33))], output=[c_customer_id#32, c_first_name#35, c_last_name#36, d_year#37, sum#57])
         :                       +- Project [c_customer_id#32, c_first_name#35, c_last_name#36, ws_net_paid#33, d_year#37]
         :                          +- SortMergeJoin [ws_sold_date_sk#40], [d_date_sk#41], Inner
         :                             :- Sort [ws_sold_date_sk#40 ASC NULLS FIRST], false, 0
         :                             :  +- Exchange hashpartitioning(ws_sold_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=30]
         :                             :     +- Project [c_customer_id#32, c_first_name#35, c_last_name#36, ws_sold_date_sk#40, ws_net_paid#33]
         :                             :        +- SortMergeJoin [c_customer_sk#42], [ws_bill_customer_sk#43], Inner
         :                             :           :- Sort [c_customer_sk#42 ASC NULLS FIRST], false, 0
         :                             :           :  +- Exchange hashpartitioning(c_customer_sk#42, 100), ENSURE_REQUIREMENTS, [plan_id=31]
         :                             :           :     +- Filter (isnotnull(c_customer_sk#42) AND isnotnull(c_customer_id#32))
         :                             :           :        +- FileScan parquet [c_customer_sk#42,c_customer_id#32,c_first_name#35,c_last_name#36] Batched: true, DataFilters: [isnotnull(c_customer_sk#42), isnotnull(c_customer_id#32)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string>
         :                             :           +- Sort [ws_bill_customer_sk#43 ASC NULLS FIRST], false, 0
         :                             :              +- Exchange hashpartitioning(ws_bill_customer_sk#43, 100), ENSURE_REQUIREMENTS, [plan_id=32]
         :                             :                 +- Filter (isnotnull(ws_bill_customer_sk#43) AND isnotnull(ws_sold_date_sk#40))
         :                             :                    +- FileScan parquet [ws_sold_date_sk#40,ws_bill_customer_sk#43,ws_net_paid#33] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#43), isnotnull(ws_sold_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_net_paid:decimal(7,2)>
         :                             +- Sort [d_date_sk#41 ASC NULLS FIRST], false, 0
         :                                +- Exchange hashpartitioning(d_date_sk#41, 100), ENSURE_REQUIREMENTS, [plan_id=33]
         :                                   +- Filter (((isnotnull(d_year#37) AND (d_year#37 = 2001)) AND d_year#37 IN (2001,2002)) AND isnotnull(d_date_sk#41))
         :                                      +- FileScan parquet [d_date_sk#41,d_year#37] Batched: true, DataFilters: [isnotnull(d_year#37), (d_year#37 = 2001), d_year#37 IN (2001,2002), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
         +- Sort [customer_id#5 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(customer_id#5, 100), ENSURE_REQUIREMENTS, [plan_id=34]
               +- HashAggregate(keys=[c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48], functions=[sum(UnscaledValue(ws_net_paid#45))], output=[customer_id#5, year_total#7])
                  +- Exchange hashpartitioning(c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48, 100), ENSURE_REQUIREMENTS, [plan_id=35]
                     +- HashAggregate(keys=[c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48], functions=[partial_sum(UnscaledValue(ws_net_paid#45))], output=[c_customer_id#44, c_first_name#46, c_last_name#47, d_year#48, sum#58])
                        +- Project [c_customer_id#44, c_first_name#46, c_last_name#47, ws_net_paid#45, d_year#48]
                           +- SortMergeJoin [ws_sold_date_sk#51], [d_date_sk#52], Inner
                              :- Sort [ws_sold_date_sk#51 ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_sold_date_sk#51, 100), ENSURE_REQUIREMENTS, [plan_id=36]
                              :     +- Project [c_customer_id#44, c_first_name#46, c_last_name#47, ws_sold_date_sk#51, ws_net_paid#45]
                              :        +- SortMergeJoin [c_customer_sk#59], [ws_bill_customer_sk#60], Inner
                              :           :- Sort [c_customer_sk#59 ASC NULLS FIRST], false, 0
                              :           :  +- Exchange hashpartitioning(c_customer_sk#59, 100), ENSURE_REQUIREMENTS, [plan_id=37]
                              :           :     +- Filter (isnotnull(c_customer_sk#59) AND isnotnull(c_customer_id#44))
                              :           :        +- FileScan parquet [c_customer_sk#59,c_customer_id#44,c_first_name#46,c_last_name#47] Batched: true, DataFilters: [isnotnull(c_customer_sk#59), isnotnull(c_customer_id#44)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string>
                              :           +- Sort [ws_bill_customer_sk#60 ASC NULLS FIRST], false, 0
                              :              +- Exchange hashpartitioning(ws_bill_customer_sk#60, 100), ENSURE_REQUIREMENTS, [plan_id=38]
                              :                 +- Filter (isnotnull(ws_bill_customer_sk#60) AND isnotnull(ws_sold_date_sk#51))
                              :                    +- FileScan parquet [ws_sold_date_sk#51,ws_bill_customer_sk#60,ws_net_paid#45] Batched: true, DataFilters: [isnotnull(ws_bill_customer_sk#60), isnotnull(ws_sold_date_sk#51)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_bill_customer_sk:int,ws_net_paid:decimal(7,2)>
                              +- Sort [d_date_sk#52 ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(d_date_sk#52, 100), ENSURE_REQUIREMENTS, [plan_id=39]
                                    +- Filter (((isnotnull(d_year#48) AND (d_year#48 = 2002)) AND d_year#48 IN (2001,2002)) AND isnotnull(d_date_sk#52))
                                       +- FileScan parquet [d_date_sk#52,d_year#48] Batched: true, DataFilters: [isnotnull(d_year#48), (d_year#48 = 2002), d_year#48 IN (2001,2002), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), In(d_year, [2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
