AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeProject [c_last_name#1, c_first_name#2, substr(s_city, 1, 30)#3, ss_ticket_number#4, amt#5, profit#6]
   +- NativeTakeOrdered 100, [c_last_name#1 ASC NULLS FIRST, c_first_name#2 ASC NULLS FIRST, substr(s_city#7, 1, 30) ASC NULLS FIRST, ss_ticket_number#4 ASC NULLS FIRST, profit#6 ASC NULLS FIRST]
      +- NativeProject [c_last_name#1, c_first_name#2, substr(s_city#7, 1, 30) AS substr(s_city, 1, 30)#3, ss_ticket_number#4, amt#5, profit#6, s_city#7]
         +- NativeSortMergeJoin [ss_customer_sk#8], [c_customer_sk#9], Inner
            :- NativeSort [ss_customer_sk#8 ASC NULLS FIRST], false
            :  +- InputAdapter
            :     +- AQEShuffleRead coalesced
            :        +- ShuffleQueryStage X
            :           +- NativeShuffleExchange hashpartitioning(ss_customer_sk#8, 100), ENSURE_REQUIREMENTS, [plan_id=1]
            :              +- NativeProject [ss_ticket_number#4, ss_customer_sk#8, s_city#7, MakeDecimal(sum(UnscaledValue(ss_coupon_amt#10))#11,17,2) AS amt#5, MakeDecimal(sum(UnscaledValue(ss_net_profit#12))#13,17,2) AS profit#6]
            :                 +- NativeHashAggregate HashAgg, ArrayBuffer(ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7), [ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7], [sum(UnscaledValue(ss_coupon_amt#10)), sum(UnscaledValue(ss_net_profit#12))], [sum(UnscaledValue(ss_coupon_amt#10))#11, sum(UnscaledValue(ss_net_profit#12))#13], 4
            :                    +- InputAdapter
            :                       +- AQEShuffleRead coalesced
            :                          +- ShuffleQueryStage X
            :                             +- NativeShuffleExchange hashpartitioning(ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7, 100), ENSURE_REQUIREMENTS, [plan_id=2]
            :                                +- NativeHashAggregate HashAgg, [ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7], [partial_sum(_c4#15), partial_sum(_c5#16)], [sum#17, sum#18], 0
            :                                   +- NativeProject [ss_ticket_number#4 AS ss_ticket_number#4, ss_customer_sk#8 AS ss_customer_sk#8, ss_addr_sk#14 AS ss_addr_sk#14, s_city#7 AS s_city#7, UnscaledValue(ss_coupon_amt#10) AS _c4#15, UnscaledValue(ss_net_profit#12) AS _c5#16]
            :                                      +- NativeProject [ss_customer_sk#8, ss_addr_sk#14, ss_ticket_number#4, ss_coupon_amt#10, ss_net_profit#12, s_city#7]
            :                                         +- NativeSortMergeJoin [ss_hdemo_sk#19], [hd_demo_sk#20], Inner
            :                                            :- NativeSort [ss_hdemo_sk#19 ASC NULLS FIRST], false
            :                                            :  +- InputAdapter
            :                                            :     +- AQEShuffleRead coalesced
            :                                            :        +- ShuffleQueryStage X
            :                                            :           +- NativeShuffleExchange hashpartitioning(ss_hdemo_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=3]
            :                                            :              +- NativeProject [ss_customer_sk#8, ss_hdemo_sk#19, ss_addr_sk#14, ss_ticket_number#4, ss_coupon_amt#10, ss_net_profit#12, s_city#7]
            :                                            :                 +- NativeSortMergeJoin [ss_store_sk#21], [s_store_sk#22], Inner
            :                                            :                    :- NativeSort [ss_store_sk#21 ASC NULLS FIRST], false
            :                                            :                    :  +- InputAdapter
            :                                            :                    :     +- AQEShuffleRead coalesced
            :                                            :                    :        +- ShuffleQueryStage X
            :                                            :                    :           +- NativeShuffleExchange hashpartitioning(ss_store_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=4]
            :                                            :                    :              +- NativeProject [ss_customer_sk#8, ss_hdemo_sk#19, ss_addr_sk#14, ss_store_sk#21, ss_ticket_number#4, ss_coupon_amt#10, ss_net_profit#12]
            :                                            :                    :                 +- NativeSortMergeJoin [ss_sold_date_sk#23], [d_date_sk#24], Inner
            :                                            :                    :                    :- NativeSort [ss_sold_date_sk#23 ASC NULLS FIRST], false
            :                                            :                    :                    :  +- InputAdapter
            :                                            :                    :                    :     +- AQEShuffleRead coalesced
            :                                            :                    :                    :        +- ShuffleQueryStage X
            :                                            :                    :                    :           +- NativeShuffleExchange hashpartitioning(ss_sold_date_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=5]
            :                                            :                    :                    :              +- NativeFilter (((isnotnull(ss_sold_date_sk#23) AND isnotnull(ss_store_sk#21)) AND isnotnull(ss_hdemo_sk#19)) AND isnotnull(ss_customer_sk#8))
            :                                            :                    :                    :                 +- InputAdapter [#23, #8, #19, #14, #21, #4, #10, #12]
            :                                            :                    :                    :                    +- NativeParquetScan  (FileScan parquet [ss_sold_date_sk#23,ss_customer_sk#8,ss_hdemo_sk#19,ss_addr_sk#14,ss_store_sk#21,ss_ticket_number#4,ss_coupon_amt#10,ss_net_profit#12] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#23), isnotnull(ss_store_sk#21), isnotnull(ss_hdemo_sk#19), is..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_t...)
            :                                            :                    :                    +- NativeSort [d_date_sk#24 ASC NULLS FIRST], false
            :                                            :                    :                       +- InputAdapter
            :                                            :                    :                          +- AQEShuffleRead coalesced
            :                                            :                    :                             +- ShuffleQueryStage X
            :                                            :                    :                                +- NativeShuffleExchange hashpartitioning(d_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=6]
            :                                            :                    :                                   +- NativeProject [d_date_sk#24]
            :                                            :                    :                                      +- NativeFilter (((isnotnull(d_dow#25) AND (d_dow#25 = 1)) AND d_year#26 IN (1999,2000,2001)) AND isnotnull(d_date_sk#24))
            :                                            :                    :                                         +- InputAdapter [#24, #26, #25]
            :                                            :                    :                                            +- NativeParquetScan  (FileScan parquet [d_date_sk#24,d_year#26,d_dow#25] Batched: true, DataFilters: [isnotnull(d_dow#25), (d_dow#25 = 1), d_year#26 IN (1999,2000,2001), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_dow:int>)
            :                                            :                    +- NativeSort [s_store_sk#22 ASC NULLS FIRST], false
            :                                            :                       +- InputAdapter
            :                                            :                          +- AQEShuffleRead coalesced
            :                                            :                             +- ShuffleQueryStage X
            :                                            :                                +- NativeShuffleExchange hashpartitioning(s_store_sk#22, 100), ENSURE_REQUIREMENTS, [plan_id=7]
            :                                            :                                   +- NativeProject [s_store_sk#22, s_city#7]
            :                                            :                                      +- NativeFilter (((isnotnull(s_number_employees#27) AND (s_number_employees#27 >= 200)) AND (s_number_employees#27 <= 295)) AND isnotnull(s_store_sk#22))
            :                                            :                                         +- InputAdapter [#22, #27, #7]
            :                                            :                                            +- NativeParquetScan  (FileScan parquet [s_store_sk#22,s_number_employees#27,s_city#7] Batched: true, DataFilters: [isnotnull(s_number_employees#27), (s_number_employees#27 >= 200), (s_number_employees#28..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(s_number_employees), GreaterThanOrEqual(s_number_employees,200), LessThanOrEqual(s_num..., ReadSchema: struct<s_store_sk:int,s_number_employees:int,s_city:string>)
            :                                            +- NativeSort [hd_demo_sk#20 ASC NULLS FIRST], false
            :                                               +- InputAdapter
            :                                                  +- AQEShuffleRead coalesced
            :                                                     +- ShuffleQueryStage X
            :                                                        +- NativeShuffleExchange hashpartitioning(hd_demo_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=8]
            :                                                           +- NativeProject [hd_demo_sk#20]
            :                                                              +- NativeFilter (((hd_dep_count#29 = 6) OR (hd_vehicle_count#30 > 2)) AND isnotnull(hd_demo_sk#20))
            :                                                                 +- InputAdapter [#20, #29, #30]
            :                                                                    +- NativeParquetScan  (FileScan parquet [hd_demo_sk#20,hd_dep_count#29,hd_vehicle_count#30] Batched: true, DataFilters: [((hd_dep_count#29 = 6) OR (hd_vehicle_count#30 > 2)), isnotnull(hd_demo_sk#20)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>, PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,6),GreaterThan(hd_vehicle_count,2)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>)
            +- NativeSort [c_customer_sk#9 ASC NULLS FIRST], false
               +- InputAdapter
                  +- AQEShuffleRead coalesced
                     +- ShuffleQueryStage X
                        +- NativeShuffleExchange hashpartitioning(c_customer_sk#9, 100), ENSURE_REQUIREMENTS, [plan_id=9]
                           +- NativeFilter isnotnull(c_customer_sk#9)
                              +- InputAdapter [#9, #2, #1]
                                 +- NativeParquetScan  (FileScan parquet [c_customer_sk#9,c_first_name#2,c_last_name#1] Batched: true, DataFilters: [isnotnull(c_customer_sk#9)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>)
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[c_last_name#1 ASC NULLS FIRST,c_first_name#2 ASC NULLS FIRST,substr(s_city#7, 1, 30) ASC NULLS FIRST,ss_ticket_number#4 ASC NULLS FIRST,profit#6 ASC NULLS FIRST], output=[c_last_name#1,c_first_name#2,substr(s_city, 1, 30)#3,ss_ticket_number#4,amt#5,profit#6])
   +- Project [c_last_name#1, c_first_name#2, substr(s_city#7, 1, 30) AS substr(s_city, 1, 30)#3, ss_ticket_number#4, amt#5, profit#6, s_city#7]
      +- SortMergeJoin [ss_customer_sk#8], [c_customer_sk#9], Inner
         :- Sort [ss_customer_sk#8 ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(ss_customer_sk#8, 100), ENSURE_REQUIREMENTS, [plan_id=10]
         :     +- HashAggregate(keys=[ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7], functions=[sum(UnscaledValue(ss_coupon_amt#10)), sum(UnscaledValue(ss_net_profit#12))], output=[ss_ticket_number#4, ss_customer_sk#8, s_city#7, amt#5, profit#6])
         :        +- Exchange hashpartitioning(ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7, 100), ENSURE_REQUIREMENTS, [plan_id=11]
         :           +- HashAggregate(keys=[ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7], functions=[partial_sum(UnscaledValue(ss_coupon_amt#10)), partial_sum(UnscaledValue(ss_net_profit#12))], output=[ss_ticket_number#4, ss_customer_sk#8, ss_addr_sk#14, s_city#7, sum#31, sum#32])
         :              +- Project [ss_customer_sk#8, ss_addr_sk#14, ss_ticket_number#4, ss_coupon_amt#10, ss_net_profit#12, s_city#7]
         :                 +- SortMergeJoin [ss_hdemo_sk#19], [hd_demo_sk#20], Inner
         :                    :- Sort [ss_hdemo_sk#19 ASC NULLS FIRST], false, 0
         :                    :  +- Exchange hashpartitioning(ss_hdemo_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=12]
         :                    :     +- Project [ss_customer_sk#8, ss_hdemo_sk#19, ss_addr_sk#14, ss_ticket_number#4, ss_coupon_amt#10, ss_net_profit#12, s_city#7]
         :                    :        +- SortMergeJoin [ss_store_sk#21], [s_store_sk#22], Inner
         :                    :           :- Sort [ss_store_sk#21 ASC NULLS FIRST], false, 0
         :                    :           :  +- Exchange hashpartitioning(ss_store_sk#21, 100), ENSURE_REQUIREMENTS, [plan_id=13]
         :                    :           :     +- Project [ss_customer_sk#8, ss_hdemo_sk#19, ss_addr_sk#14, ss_store_sk#21, ss_ticket_number#4, ss_coupon_amt#10, ss_net_profit#12]
         :                    :           :        +- SortMergeJoin [ss_sold_date_sk#23], [d_date_sk#24], Inner
         :                    :           :           :- Sort [ss_sold_date_sk#23 ASC NULLS FIRST], false, 0
         :                    :           :           :  +- Exchange hashpartitioning(ss_sold_date_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=14]
         :                    :           :           :     +- Filter (((isnotnull(ss_sold_date_sk#23) AND isnotnull(ss_store_sk#21)) AND isnotnull(ss_hdemo_sk#19)) AND isnotnull(ss_customer_sk#8))
         :                    :           :           :        +- FileScan parquet [ss_sold_date_sk#23,ss_customer_sk#8,ss_hdemo_sk#19,ss_addr_sk#14,ss_store_sk#21,ss_ticket_number#4,ss_coupon_amt#10,ss_net_profit#12] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#23), isnotnull(ss_store_sk#21), isnotnull(ss_hdemo_sk#19), is..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_t...
         :                    :           :           +- Sort [d_date_sk#24 ASC NULLS FIRST], false, 0
         :                    :           :              +- Exchange hashpartitioning(d_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=15]
         :                    :           :                 +- Project [d_date_sk#24]
         :                    :           :                    +- Filter (((isnotnull(d_dow#25) AND (d_dow#25 = 1)) AND d_year#26 IN (1999,2000,2001)) AND isnotnull(d_date_sk#24))
         :                    :           :                       +- FileScan parquet [d_date_sk#24,d_year#26,d_dow#25] Batched: true, DataFilters: [isnotnull(d_dow#25), (d_dow#25 = 1), d_year#26 IN (1999,2000,2001), isnotnull(d_date_sk..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_dow:int>
         :                    :           +- Sort [s_store_sk#22 ASC NULLS FIRST], false, 0
         :                    :              +- Exchange hashpartitioning(s_store_sk#22, 100), ENSURE_REQUIREMENTS, [plan_id=16]
         :                    :                 +- Project [s_store_sk#22, s_city#7]
         :                    :                    +- Filter (((isnotnull(s_number_employees#27) AND (s_number_employees#27 >= 200)) AND (s_number_employees#27 <= 295)) AND isnotnull(s_store_sk#22))
         :                    :                       +- FileScan parquet [s_store_sk#22,s_number_employees#27,s_city#7] Batched: true, DataFilters: [isnotnull(s_number_employees#27), (s_number_employees#27 >= 200), (s_number_employees#28..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(s_number_employees), GreaterThanOrEqual(s_number_employees,200), LessThanOrEqual(s_num..., ReadSchema: struct<s_store_sk:int,s_number_employees:int,s_city:string>
         :                    +- Sort [hd_demo_sk#20 ASC NULLS FIRST], false, 0
         :                       +- Exchange hashpartitioning(hd_demo_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=17]
         :                          +- Project [hd_demo_sk#20]
         :                             +- Filter (((hd_dep_count#29 = 6) OR (hd_vehicle_count#30 > 2)) AND isnotnull(hd_demo_sk#20))
         :                                +- FileScan parquet [hd_demo_sk#20,hd_dep_count#29,hd_vehicle_count#30] Batched: true, DataFilters: [((hd_dep_count#29 = 6) OR (hd_vehicle_count#30 > 2)), isnotnull(hd_demo_sk#20)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>, PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,6),GreaterThan(hd_vehicle_count,2)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>
         +- Sort [c_customer_sk#9 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(c_customer_sk#9, 100), ENSURE_REQUIREMENTS, [plan_id=18]
               +- Filter isnotnull(c_customer_sk#9)
                  +- FileScan parquet [c_customer_sk#9,c_first_name#2,c_last_name#1] Batched: true, DataFilters: [isnotnull(c_customer_sk#9)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>
