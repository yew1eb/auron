AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeTakeOrdered 100, [(sum_sales#1 - avg_monthly_sales#2) ASC NULLS FIRST, cc_name#3 ASC NULLS FIRST]
   +- NativeProject [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, avg_monthly_sales#2, sum_sales#1, sum_sales#8 AS psum#9, sum_sales#10 AS nsum#11]
      +- NativeSortMergeJoin [i_category#4, i_brand#5, cc_name#3, rn#12], [i_category#13, i_brand#14, cc_name#15, (rn#16 - 1)], Inner
         :- NativeProject [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, sum_sales#1, avg_monthly_sales#2, rn#12, sum_sales#8]
         :  +- NativeSortMergeJoin [i_category#4, i_brand#5, cc_name#3, rn#12], [i_category#17, i_brand#18, cc_name#19, (rn#20 + 1)], Inner
         :     :- NativeSort [i_category#4 ASC NULLS FIRST, i_brand#5 ASC NULLS FIRST, cc_name#3 ASC NULLS FIRST, rn#12 ASC NULLS FIRST], false
         :     :  +- InputAdapter
         :     :     +- AQEShuffleRead coalesced
         :     :        +- ShuffleQueryStage X
         :     :           +- NativeShuffleExchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, rn#12, 100), ENSURE_REQUIREMENTS, [plan_id=1]
         :     :              +- ConvertToNative
         :     :                 +- *(1) Project [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, sum_sales#1, avg_monthly_sales#2, rn#12]
         :     :                    +- *(1) Filter ((isnotnull(avg_monthly_sales#2) AND (avg_monthly_sales#2 > 0.000000)) AND CASE WHEN (avg_monthly_sales#2 > 0.000000) THEN ((abs((sum_sales#1 - avg_monthly_sales#2)) / avg_monthly_sales#2) > 0.1000000000000000) END)
         :     :                       +- Window [avg(_w0#21) windowspecdefinition(i_category#4, i_brand#5, cc_name#3, d_year#6, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#2], [i_category#4, i_brand#5, cc_name#3, d_year#6]
         :     :                          +- NativeFilter (isnotnull(d_year#6) AND (d_year#6 = 1999))
         :     :                             +- NativeWindow [rank(d_year#6, d_moy#7) windowspecdefinition(i_category#4, i_brand#5, cc_name#3, d_year#6 ASC NULLS FIRST, d_moy#7 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#12], [i_category#4, i_brand#5, cc_name#3], [d_year#6 ASC NULLS FIRST, d_moy#7 ASC NULLS FIRST]
         :     :                                +- NativeSort [i_category#4 ASC NULLS FIRST, i_brand#5 ASC NULLS FIRST, cc_name#3 ASC NULLS FIRST, d_year#6 ASC NULLS FIRST, d_moy#7 ASC NULLS FIRST], false
         :     :                                   +- InputAdapter
         :     :                                      +- AQEShuffleRead coalesced
         :     :                                         +- ShuffleQueryStage X
         :     :                                            +- NativeShuffleExchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, 100), ENSURE_REQUIREMENTS, [plan_id=2]
         :     :                                               +- NativeProject [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, MakeDecimal(sum(UnscaledValue(cs_sales_price#22))#23,17,2) AS sum_sales#1, MakeDecimal(sum(UnscaledValue(cs_sales_price#22))#23,17,2) AS _w0#21]
         :     :                                                  +- NativeHashAggregate HashAgg, ArrayBuffer(i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7), [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7], [sum(UnscaledValue(cs_sales_price#22))], [sum(UnscaledValue(cs_sales_price#22))#23], 5
         :     :                                                     +- InputAdapter
         :     :                                                        +- AQEShuffleRead coalesced
         :     :                                                           +- ShuffleQueryStage X
         :     :                                                              +- NativeShuffleExchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, 100), ENSURE_REQUIREMENTS, [plan_id=3]
         :     :                                                                 +- NativeHashAggregate HashAgg, [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7], [partial_sum(_c5#24)], [sum#25], 0
         :     :                                                                    +- NativeProject [i_category#4 AS i_category#4, i_brand#5 AS i_brand#5, cc_name#3 AS cc_name#3, d_year#6 AS d_year#6, d_moy#7 AS d_moy#7, UnscaledValue(cs_sales_price#22) AS _c5#24]
         :     :                                                                       +- NativeProject [i_brand#5, i_category#4, cs_sales_price#22, d_year#6, d_moy#7, cc_name#3]
         :     :                                                                          +- NativeSortMergeJoin [cs_call_center_sk#26], [cc_call_center_sk#27], Inner
         :     :                                                                             :- NativeSort [cs_call_center_sk#26 ASC NULLS FIRST], false
         :     :                                                                             :  +- InputAdapter
         :     :                                                                             :     +- AQEShuffleRead coalesced
         :     :                                                                             :        +- ShuffleQueryStage X
         :     :                                                                             :           +- NativeShuffleExchange hashpartitioning(cs_call_center_sk#26, 100), ENSURE_REQUIREMENTS, [plan_id=4]
         :     :                                                                             :              +- NativeProject [i_brand#5, i_category#4, cs_call_center_sk#26, cs_sales_price#22, d_year#6, d_moy#7]
         :     :                                                                             :                 +- NativeSortMergeJoin [cs_sold_date_sk#28], [d_date_sk#29], Inner
         :     :                                                                             :                    :- NativeSort [cs_sold_date_sk#28 ASC NULLS FIRST], false
         :     :                                                                             :                    :  +- InputAdapter
         :     :                                                                             :                    :     +- AQEShuffleRead coalesced
         :     :                                                                             :                    :        +- ShuffleQueryStage X
         :     :                                                                             :                    :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#28, 100), ENSURE_REQUIREMENTS, [plan_id=5]
         :     :                                                                             :                    :              +- NativeProject [i_brand#5, i_category#4, cs_sold_date_sk#28, cs_call_center_sk#26, cs_sales_price#22]
         :     :                                                                             :                    :                 +- NativeSortMergeJoin [i_item_sk#30], [cs_item_sk#31], Inner
         :     :                                                                             :                    :                    :- NativeSort [i_item_sk#30 ASC NULLS FIRST], false
         :     :                                                                             :                    :                    :  +- InputAdapter
         :     :                                                                             :                    :                    :     +- AQEShuffleRead coalesced
         :     :                                                                             :                    :                    :        +- ShuffleQueryStage X
         :     :                                                                             :                    :                    :           +- NativeShuffleExchange hashpartitioning(i_item_sk#30, 100), ENSURE_REQUIREMENTS, [plan_id=6]
         :     :                                                                             :                    :                    :              +- NativeFilter ((isnotnull(i_item_sk#30) AND isnotnull(i_category#4)) AND isnotnull(i_brand#5))
         :     :                                                                             :                    :                    :                 +- InputAdapter [#30, #5, #4]
         :     :                                                                             :                    :                    :                    +- NativeParquetScan  (FileScan parquet [i_item_sk#30,i_brand#5,i_category#4] Batched: true, DataFilters: [isnotnull(i_item_sk#30), isnotnull(i_category#4), isnotnull(i_brand#5)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>)
         :     :                                                                             :                    :                    +- NativeSort [cs_item_sk#31 ASC NULLS FIRST], false
         :     :                                                                             :                    :                       +- InputAdapter
         :     :                                                                             :                    :                          +- AQEShuffleRead coalesced
         :     :                                                                             :                    :                             +- ShuffleQueryStage X
         :     :                                                                             :                    :                                +- NativeShuffleExchange hashpartitioning(cs_item_sk#31, 100), ENSURE_REQUIREMENTS, [plan_id=7]
         :     :                                                                             :                    :                                   +- NativeFilter ((isnotnull(cs_item_sk#31) AND isnotnull(cs_sold_date_sk#28)) AND isnotnull(cs_call_center_sk#26))
         :     :                                                                             :                    :                                      +- InputAdapter [#28, #26, #31, #22]
         :     :                                                                             :                    :                                         +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#28,cs_call_center_sk#26,cs_item_sk#31,cs_sales_price#22] Batched: true, DataFilters: [isnotnull(cs_item_sk#31), isnotnull(cs_sold_date_sk#28), isnotnull(cs_call_center_sk#26)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_call_center_sk:int,cs_item_sk:int,cs_sales_price:decimal(7,2)>)
         :     :                                                                             :                    +- NativeSort [d_date_sk#29 ASC NULLS FIRST], false
         :     :                                                                             :                       +- InputAdapter
         :     :                                                                             :                          +- AQEShuffleRead coalesced
         :     :                                                                             :                             +- ShuffleQueryStage X
         :     :                                                                             :                                +- NativeShuffleExchange hashpartitioning(d_date_sk#29, 100), ENSURE_REQUIREMENTS, [plan_id=8]
         :     :                                                                             :                                   +- NativeFilter ((((d_year#6 = 1999) OR ((d_year#6 = 1998) AND (d_moy#7 = 12))) OR ((d_year#6 = 2000) AND (d_moy#7 = 1))) AND isnotnull(d_date_sk#29))
         :     :                                                                             :                                      +- InputAdapter [#29, #6, #7]
         :     :                                                                             :                                         +- NativeParquetScan  (FileScan parquet [d_date_sk#29,d_year#6,d_moy#7] Batched: true, DataFilters: [(((d_year#6 = 1999) OR ((d_year#6 = 1998) AND (d_moy#7 = 12))) OR ((d_year#6 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,1999),And(EqualTo(d_year,1998),EqualTo(d_moy,12))),And(EqualTo(d_year,2000)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>)
         :     :                                                                             +- NativeSort [cc_call_center_sk#27 ASC NULLS FIRST], false
         :     :                                                                                +- InputAdapter
         :     :                                                                                   +- AQEShuffleRead coalesced
         :     :                                                                                      +- ShuffleQueryStage X
         :     :                                                                                         +- NativeShuffleExchange hashpartitioning(cc_call_center_sk#27, 100), ENSURE_REQUIREMENTS, [plan_id=9]
         :     :                                                                                            +- NativeFilter (isnotnull(cc_call_center_sk#27) AND isnotnull(cc_name#3))
         :     :                                                                                               +- InputAdapter [#27, #3]
         :     :                                                                                                  +- NativeParquetScan  (FileScan parquet [cc_call_center_sk#27,cc_name#3] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#27), isnotnull(cc_name#3)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>)
         :     +- NativeSort [i_category#17 ASC NULLS FIRST, i_brand#18 ASC NULLS FIRST, cc_name#19 ASC NULLS FIRST, (rn#20 + 1) ASC NULLS FIRST], false
         :        +- InputAdapter
         :           +- AQEShuffleRead coalesced
         :              +- ShuffleQueryStage X
         :                 +- NativeShuffleExchange hashpartitioning(i_category#17, i_brand#18, cc_name#19, (rn#20 + 1), 100), ENSURE_REQUIREMENTS, [plan_id=10]
         :                    +- NativeProject [i_category#17, i_brand#18, cc_name#19, sum_sales#1 AS sum_sales#8, rn#20]
         :                       +- NativeWindow [rank(d_year#32, d_moy#33) windowspecdefinition(i_category#17, i_brand#18, cc_name#19, d_year#32 ASC NULLS FIRST, d_moy#33 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#20], [i_category#17, i_brand#18, cc_name#19], [d_year#32 ASC NULLS FIRST, d_moy#33 ASC NULLS FIRST]
         :                          +- NativeSort [i_category#17 ASC NULLS FIRST, i_brand#18 ASC NULLS FIRST, cc_name#19 ASC NULLS FIRST, d_year#32 ASC NULLS FIRST, d_moy#33 ASC NULLS FIRST], false
         :                             +- InputAdapter
         :                                +- AQEShuffleRead coalesced
         :                                   +- ShuffleQueryStage X
         :                                      +- NativeShuffleExchange hashpartitioning(i_category#17, i_brand#18, cc_name#19, 100), ENSURE_REQUIREMENTS, [plan_id=11]
         :                                         +- NativeProject [i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33, MakeDecimal(sum(UnscaledValue(cs_sales_price#34))#23,17,2) AS sum_sales#1]
         :                                            +- NativeHashAggregate HashAgg, ArrayBuffer(i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33), [i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33], [sum(UnscaledValue(cs_sales_price#34))], [sum(UnscaledValue(cs_sales_price#34))#23], 5
         :                                               +- InputAdapter
         :                                                  +- InputAdapter [#17, #18, #19, #32, #33, #35]
         :                                                     +- AQEShuffleRead coalesced
         :                                                        +- ShuffleQueryStage X
         :                                                           +- ReusedExchange [i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33, sum#36], NativeShuffleExchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, 100), ENSURE_REQUIREMENTS, [plan_id=3]
         +- NativeSort [i_category#13 ASC NULLS FIRST, i_brand#14 ASC NULLS FIRST, cc_name#15 ASC NULLS FIRST, (rn#16 - 1) ASC NULLS FIRST], false
            +- InputAdapter
               +- AQEShuffleRead coalesced
                  +- ShuffleQueryStage X
                     +- NativeShuffleExchange hashpartitioning(i_category#13, i_brand#14, cc_name#15, (rn#16 - 1), 100), ENSURE_REQUIREMENTS, [plan_id=12]
                        +- NativeProject [i_category#13, i_brand#14, cc_name#15, sum_sales#1 AS sum_sales#10, rn#16]
                           +- NativeWindow [rank(d_year#37, d_moy#38) windowspecdefinition(i_category#13, i_brand#14, cc_name#15, d_year#37 ASC NULLS FIRST, d_moy#38 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16], [i_category#13, i_brand#14, cc_name#15], [d_year#37 ASC NULLS FIRST, d_moy#38 ASC NULLS FIRST]
                              +- NativeSort [i_category#13 ASC NULLS FIRST, i_brand#14 ASC NULLS FIRST, cc_name#15 ASC NULLS FIRST, d_year#37 ASC NULLS FIRST, d_moy#38 ASC NULLS FIRST], false
                                 +- InputAdapter
                                    +- InputAdapter [#13, #14, #15, #37, #38, #1]
                                       +- AQEShuffleRead coalesced
                                          +- ShuffleQueryStage X
                                             +- ReusedExchange [i_category#13, i_brand#14, cc_name#15, d_year#37, d_moy#38, sum_sales#1], NativeShuffleExchange hashpartitioning(i_category#17, i_brand#18, cc_name#19, 100), ENSURE_REQUIREMENTS, [plan_id=11]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[(sum_sales#1 - avg_monthly_sales#2) ASC NULLS FIRST,cc_name#3 ASC NULLS FIRST], output=[i_category#4,i_brand#5,cc_name#3,d_year#6,d_moy#7,avg_monthly_sales#2,sum_sales#1,psum#9,nsum#11])
   +- Project [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, avg_monthly_sales#2, sum_sales#1, sum_sales#8 AS psum#9, sum_sales#10 AS nsum#11]
      +- SortMergeJoin [i_category#4, i_brand#5, cc_name#3, rn#12], [i_category#13, i_brand#14, cc_name#15, (rn#16 - 1)], Inner
         :- Project [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, sum_sales#1, avg_monthly_sales#2, rn#12, sum_sales#8]
         :  +- SortMergeJoin [i_category#4, i_brand#5, cc_name#3, rn#12], [i_category#17, i_brand#18, cc_name#19, (rn#20 + 1)], Inner
         :     :- Sort [i_category#4 ASC NULLS FIRST, i_brand#5 ASC NULLS FIRST, cc_name#3 ASC NULLS FIRST, rn#12 ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, rn#12, 100), ENSURE_REQUIREMENTS, [plan_id=13]
         :     :     +- Project [i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, sum_sales#1, avg_monthly_sales#2, rn#12]
         :     :        +- Filter ((isnotnull(avg_monthly_sales#2) AND (avg_monthly_sales#2 > 0.000000)) AND CASE WHEN (avg_monthly_sales#2 > 0.000000) THEN ((abs((sum_sales#1 - avg_monthly_sales#2)) / avg_monthly_sales#2) > 0.1000000000000000) END)
         :     :           +- Window [avg(_w0#21) windowspecdefinition(i_category#4, i_brand#5, cc_name#3, d_year#6, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#2], [i_category#4, i_brand#5, cc_name#3, d_year#6]
         :     :              +- Filter (isnotnull(d_year#6) AND (d_year#6 = 1999))
         :     :                 +- Window [rank(d_year#6, d_moy#7) windowspecdefinition(i_category#4, i_brand#5, cc_name#3, d_year#6 ASC NULLS FIRST, d_moy#7 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#12], [i_category#4, i_brand#5, cc_name#3], [d_year#6 ASC NULLS FIRST, d_moy#7 ASC NULLS FIRST]
         :     :                    +- Sort [i_category#4 ASC NULLS FIRST, i_brand#5 ASC NULLS FIRST, cc_name#3 ASC NULLS FIRST, d_year#6 ASC NULLS FIRST, d_moy#7 ASC NULLS FIRST], false, 0
         :     :                       +- Exchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, 100), ENSURE_REQUIREMENTS, [plan_id=14]
         :     :                          +- HashAggregate(keys=[i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7], functions=[sum(UnscaledValue(cs_sales_price#22))], output=[i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, sum_sales#1, _w0#21])
         :     :                             +- Exchange hashpartitioning(i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, 100), ENSURE_REQUIREMENTS, [plan_id=15]
         :     :                                +- HashAggregate(keys=[i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7], functions=[partial_sum(UnscaledValue(cs_sales_price#22))], output=[i_category#4, i_brand#5, cc_name#3, d_year#6, d_moy#7, sum#39])
         :     :                                   +- Project [i_brand#5, i_category#4, cs_sales_price#22, d_year#6, d_moy#7, cc_name#3]
         :     :                                      +- SortMergeJoin [cs_call_center_sk#26], [cc_call_center_sk#27], Inner
         :     :                                         :- Sort [cs_call_center_sk#26 ASC NULLS FIRST], false, 0
         :     :                                         :  +- Exchange hashpartitioning(cs_call_center_sk#26, 100), ENSURE_REQUIREMENTS, [plan_id=16]
         :     :                                         :     +- Project [i_brand#5, i_category#4, cs_call_center_sk#26, cs_sales_price#22, d_year#6, d_moy#7]
         :     :                                         :        +- SortMergeJoin [cs_sold_date_sk#28], [d_date_sk#29], Inner
         :     :                                         :           :- Sort [cs_sold_date_sk#28 ASC NULLS FIRST], false, 0
         :     :                                         :           :  +- Exchange hashpartitioning(cs_sold_date_sk#28, 100), ENSURE_REQUIREMENTS, [plan_id=17]
         :     :                                         :           :     +- Project [i_brand#5, i_category#4, cs_sold_date_sk#28, cs_call_center_sk#26, cs_sales_price#22]
         :     :                                         :           :        +- SortMergeJoin [i_item_sk#30], [cs_item_sk#31], Inner
         :     :                                         :           :           :- Sort [i_item_sk#30 ASC NULLS FIRST], false, 0
         :     :                                         :           :           :  +- Exchange hashpartitioning(i_item_sk#30, 100), ENSURE_REQUIREMENTS, [plan_id=18]
         :     :                                         :           :           :     +- Filter ((isnotnull(i_item_sk#30) AND isnotnull(i_category#4)) AND isnotnull(i_brand#5))
         :     :                                         :           :           :        +- FileScan parquet [i_item_sk#30,i_brand#5,i_category#4] Batched: true, DataFilters: [isnotnull(i_item_sk#30), isnotnull(i_category#4), isnotnull(i_brand#5)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :     :                                         :           :           +- Sort [cs_item_sk#31 ASC NULLS FIRST], false, 0
         :     :                                         :           :              +- Exchange hashpartitioning(cs_item_sk#31, 100), ENSURE_REQUIREMENTS, [plan_id=19]
         :     :                                         :           :                 +- Filter ((isnotnull(cs_item_sk#31) AND isnotnull(cs_sold_date_sk#28)) AND isnotnull(cs_call_center_sk#26))
         :     :                                         :           :                    +- FileScan parquet [cs_sold_date_sk#28,cs_call_center_sk#26,cs_item_sk#31,cs_sales_price#22] Batched: true, DataFilters: [isnotnull(cs_item_sk#31), isnotnull(cs_sold_date_sk#28), isnotnull(cs_call_center_sk#26)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_call_center_sk:int,cs_item_sk:int,cs_sales_price:decimal(7,2)>
         :     :                                         :           +- Sort [d_date_sk#29 ASC NULLS FIRST], false, 0
         :     :                                         :              +- Exchange hashpartitioning(d_date_sk#29, 100), ENSURE_REQUIREMENTS, [plan_id=20]
         :     :                                         :                 +- Filter ((((d_year#6 = 1999) OR ((d_year#6 = 1998) AND (d_moy#7 = 12))) OR ((d_year#6 = 2000) AND (d_moy#7 = 1))) AND isnotnull(d_date_sk#29))
         :     :                                         :                    +- FileScan parquet [d_date_sk#29,d_year#6,d_moy#7] Batched: true, DataFilters: [(((d_year#6 = 1999) OR ((d_year#6 = 1998) AND (d_moy#7 = 12))) OR ((d_year#6 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,1999),And(EqualTo(d_year,1998),EqualTo(d_moy,12))),And(EqualTo(d_year,2000)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :     :                                         +- Sort [cc_call_center_sk#27 ASC NULLS FIRST], false, 0
         :     :                                            +- Exchange hashpartitioning(cc_call_center_sk#27, 100), ENSURE_REQUIREMENTS, [plan_id=21]
         :     :                                               +- Filter (isnotnull(cc_call_center_sk#27) AND isnotnull(cc_name#3))
         :     :                                                  +- FileScan parquet [cc_call_center_sk#27,cc_name#3] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#27), isnotnull(cc_name#3)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
         :     +- Sort [i_category#17 ASC NULLS FIRST, i_brand#18 ASC NULLS FIRST, cc_name#19 ASC NULLS FIRST, (rn#20 + 1) ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(i_category#17, i_brand#18, cc_name#19, (rn#20 + 1), 100), ENSURE_REQUIREMENTS, [plan_id=22]
         :           +- Project [i_category#17, i_brand#18, cc_name#19, sum_sales#1 AS sum_sales#8, rn#20]
         :              +- Window [rank(d_year#32, d_moy#33) windowspecdefinition(i_category#17, i_brand#18, cc_name#19, d_year#32 ASC NULLS FIRST, d_moy#33 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#20], [i_category#17, i_brand#18, cc_name#19], [d_year#32 ASC NULLS FIRST, d_moy#33 ASC NULLS FIRST]
         :                 +- Sort [i_category#17 ASC NULLS FIRST, i_brand#18 ASC NULLS FIRST, cc_name#19 ASC NULLS FIRST, d_year#32 ASC NULLS FIRST, d_moy#33 ASC NULLS FIRST], false, 0
         :                    +- Exchange hashpartitioning(i_category#17, i_brand#18, cc_name#19, 100), ENSURE_REQUIREMENTS, [plan_id=23]
         :                       +- HashAggregate(keys=[i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33], functions=[sum(UnscaledValue(cs_sales_price#34))], output=[i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33, sum_sales#1])
         :                          +- Exchange hashpartitioning(i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33, 100), ENSURE_REQUIREMENTS, [plan_id=24]
         :                             +- HashAggregate(keys=[i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33], functions=[partial_sum(UnscaledValue(cs_sales_price#34))], output=[i_category#17, i_brand#18, cc_name#19, d_year#32, d_moy#33, sum#36])
         :                                +- Project [i_brand#18, i_category#17, cs_sales_price#34, d_year#32, d_moy#33, cc_name#19]
         :                                   +- SortMergeJoin [cs_call_center_sk#40], [cc_call_center_sk#41], Inner
         :                                      :- Sort [cs_call_center_sk#40 ASC NULLS FIRST], false, 0
         :                                      :  +- Exchange hashpartitioning(cs_call_center_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=25]
         :                                      :     +- Project [i_brand#18, i_category#17, cs_call_center_sk#40, cs_sales_price#34, d_year#32, d_moy#33]
         :                                      :        +- SortMergeJoin [cs_sold_date_sk#42], [d_date_sk#43], Inner
         :                                      :           :- Sort [cs_sold_date_sk#42 ASC NULLS FIRST], false, 0
         :                                      :           :  +- Exchange hashpartitioning(cs_sold_date_sk#42, 100), ENSURE_REQUIREMENTS, [plan_id=26]
         :                                      :           :     +- Project [i_brand#18, i_category#17, cs_sold_date_sk#42, cs_call_center_sk#40, cs_sales_price#34]
         :                                      :           :        +- SortMergeJoin [i_item_sk#44], [cs_item_sk#45], Inner
         :                                      :           :           :- Sort [i_item_sk#44 ASC NULLS FIRST], false, 0
         :                                      :           :           :  +- Exchange hashpartitioning(i_item_sk#44, 100), ENSURE_REQUIREMENTS, [plan_id=27]
         :                                      :           :           :     +- Filter ((isnotnull(i_item_sk#44) AND isnotnull(i_category#17)) AND isnotnull(i_brand#18))
         :                                      :           :           :        +- FileScan parquet [i_item_sk#44,i_brand#18,i_category#17] Batched: true, DataFilters: [isnotnull(i_item_sk#44), isnotnull(i_category#17), isnotnull(i_brand#18)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :                                      :           :           +- Sort [cs_item_sk#45 ASC NULLS FIRST], false, 0
         :                                      :           :              +- Exchange hashpartitioning(cs_item_sk#45, 100), ENSURE_REQUIREMENTS, [plan_id=28]
         :                                      :           :                 +- Filter ((isnotnull(cs_item_sk#45) AND isnotnull(cs_sold_date_sk#42)) AND isnotnull(cs_call_center_sk#40))
         :                                      :           :                    +- FileScan parquet [cs_sold_date_sk#42,cs_call_center_sk#40,cs_item_sk#45,cs_sales_price#34] Batched: true, DataFilters: [isnotnull(cs_item_sk#45), isnotnull(cs_sold_date_sk#42), isnotnull(cs_call_center_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_call_center_sk:int,cs_item_sk:int,cs_sales_price:decimal(7,2)>
         :                                      :           +- Sort [d_date_sk#43 ASC NULLS FIRST], false, 0
         :                                      :              +- Exchange hashpartitioning(d_date_sk#43, 100), ENSURE_REQUIREMENTS, [plan_id=29]
         :                                      :                 +- Filter ((((d_year#32 = 1999) OR ((d_year#32 = 1998) AND (d_moy#33 = 12))) OR ((d_year#32 = 2000) AND (d_moy#33 = 1))) AND isnotnull(d_date_sk#43))
         :                                      :                    +- FileScan parquet [d_date_sk#43,d_year#32,d_moy#33] Batched: true, DataFilters: [(((d_year#32 = 1999) OR ((d_year#32 = 1998) AND (d_moy#33 = 12))) OR ((d_year#32 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,1999),And(EqualTo(d_year,1998),EqualTo(d_moy,12))),And(EqualTo(d_year,2000)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :                                      +- Sort [cc_call_center_sk#41 ASC NULLS FIRST], false, 0
         :                                         +- Exchange hashpartitioning(cc_call_center_sk#41, 100), ENSURE_REQUIREMENTS, [plan_id=30]
         :                                            +- Filter (isnotnull(cc_call_center_sk#41) AND isnotnull(cc_name#19))
         :                                               +- FileScan parquet [cc_call_center_sk#41,cc_name#19] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#41), isnotnull(cc_name#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
         +- Sort [i_category#13 ASC NULLS FIRST, i_brand#14 ASC NULLS FIRST, cc_name#15 ASC NULLS FIRST, (rn#16 - 1) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_category#13, i_brand#14, cc_name#15, (rn#16 - 1), 100), ENSURE_REQUIREMENTS, [plan_id=31]
               +- Project [i_category#13, i_brand#14, cc_name#15, sum_sales#1 AS sum_sales#10, rn#16]
                  +- Window [rank(d_year#37, d_moy#38) windowspecdefinition(i_category#13, i_brand#14, cc_name#15, d_year#37 ASC NULLS FIRST, d_moy#38 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16], [i_category#13, i_brand#14, cc_name#15], [d_year#37 ASC NULLS FIRST, d_moy#38 ASC NULLS FIRST]
                     +- Sort [i_category#13 ASC NULLS FIRST, i_brand#14 ASC NULLS FIRST, cc_name#15 ASC NULLS FIRST, d_year#37 ASC NULLS FIRST, d_moy#38 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_category#13, i_brand#14, cc_name#15, 100), ENSURE_REQUIREMENTS, [plan_id=32]
                           +- HashAggregate(keys=[i_category#13, i_brand#14, cc_name#15, d_year#37, d_moy#38], functions=[sum(UnscaledValue(cs_sales_price#46))], output=[i_category#13, i_brand#14, cc_name#15, d_year#37, d_moy#38, sum_sales#1])
                              +- Exchange hashpartitioning(i_category#13, i_brand#14, cc_name#15, d_year#37, d_moy#38, 100), ENSURE_REQUIREMENTS, [plan_id=33]
                                 +- HashAggregate(keys=[i_category#13, i_brand#14, cc_name#15, d_year#37, d_moy#38], functions=[partial_sum(UnscaledValue(cs_sales_price#46))], output=[i_category#13, i_brand#14, cc_name#15, d_year#37, d_moy#38, sum#47])
                                    +- Project [i_brand#14, i_category#13, cs_sales_price#46, d_year#37, d_moy#38, cc_name#15]
                                       +- SortMergeJoin [cs_call_center_sk#48], [cc_call_center_sk#49], Inner
                                          :- Sort [cs_call_center_sk#48 ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(cs_call_center_sk#48, 100), ENSURE_REQUIREMENTS, [plan_id=34]
                                          :     +- Project [i_brand#14, i_category#13, cs_call_center_sk#48, cs_sales_price#46, d_year#37, d_moy#38]
                                          :        +- SortMergeJoin [cs_sold_date_sk#50], [d_date_sk#51], Inner
                                          :           :- Sort [cs_sold_date_sk#50 ASC NULLS FIRST], false, 0
                                          :           :  +- Exchange hashpartitioning(cs_sold_date_sk#50, 100), ENSURE_REQUIREMENTS, [plan_id=35]
                                          :           :     +- Project [i_brand#14, i_category#13, cs_sold_date_sk#50, cs_call_center_sk#48, cs_sales_price#46]
                                          :           :        +- SortMergeJoin [i_item_sk#52], [cs_item_sk#53], Inner
                                          :           :           :- Sort [i_item_sk#52 ASC NULLS FIRST], false, 0
                                          :           :           :  +- Exchange hashpartitioning(i_item_sk#52, 100), ENSURE_REQUIREMENTS, [plan_id=36]
                                          :           :           :     +- Filter ((isnotnull(i_item_sk#52) AND isnotnull(i_category#13)) AND isnotnull(i_brand#14))
                                          :           :           :        +- FileScan parquet [i_item_sk#52,i_brand#14,i_category#13] Batched: true, DataFilters: [isnotnull(i_item_sk#52), isnotnull(i_category#13), isnotnull(i_brand#14)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
                                          :           :           +- Sort [cs_item_sk#53 ASC NULLS FIRST], false, 0
                                          :           :              +- Exchange hashpartitioning(cs_item_sk#53, 100), ENSURE_REQUIREMENTS, [plan_id=37]
                                          :           :                 +- Filter ((isnotnull(cs_item_sk#53) AND isnotnull(cs_sold_date_sk#50)) AND isnotnull(cs_call_center_sk#48))
                                          :           :                    +- FileScan parquet [cs_sold_date_sk#50,cs_call_center_sk#48,cs_item_sk#53,cs_sales_price#46] Batched: true, DataFilters: [isnotnull(cs_item_sk#53), isnotnull(cs_sold_date_sk#50), isnotnull(cs_call_center_sk#48)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_call_center_sk:int,cs_item_sk:int,cs_sales_price:decimal(7,2)>
                                          :           +- Sort [d_date_sk#51 ASC NULLS FIRST], false, 0
                                          :              +- Exchange hashpartitioning(d_date_sk#51, 100), ENSURE_REQUIREMENTS, [plan_id=38]
                                          :                 +- Filter ((((d_year#37 = 1999) OR ((d_year#37 = 1998) AND (d_moy#38 = 12))) OR ((d_year#37 = 2000) AND (d_moy#38 = 1))) AND isnotnull(d_date_sk#51))
                                          :                    +- FileScan parquet [d_date_sk#51,d_year#37,d_moy#38] Batched: true, DataFilters: [(((d_year#37 = 1999) OR ((d_year#37 = 1998) AND (d_moy#38 = 12))) OR ((d_year#37 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,1999),And(EqualTo(d_year,1998),EqualTo(d_moy,12))),And(EqualTo(d_year,2000)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                                          +- Sort [cc_call_center_sk#49 ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(cc_call_center_sk#49, 100), ENSURE_REQUIREMENTS, [plan_id=39]
                                                +- Filter (isnotnull(cc_call_center_sk#49) AND isnotnull(cc_name#15))
                                                   +- FileScan parquet [cc_call_center_sk#49,cc_name#15] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#49), isnotnull(cc_name#15)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
