AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeProject [sum(CASE WHEN (isnotnull(customer_sk#1) AND isnull(customer_sk#2)) THEN 1 ELSE 0 END)#3 AS store_only#4, sum(CASE WHEN (isnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)#5 AS catalog_only#6, sum(CASE WHEN (isnotnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)#7 AS store_and_catalog#8]
   +- NativeHashAggregate HashAgg, List(), [sum(CASE WHEN (isnotnull(customer_sk#1) AND isnull(customer_sk#2)) THEN 1 ELSE 0 END), sum(CASE WHEN (isnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END), sum(CASE WHEN (isnotnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)], [sum(CASE WHEN (isnotnull(customer_sk#1) AND isnull(customer_sk#2)) THEN 1 ELSE 0 END)#3, sum(CASE WHEN (isnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)#5, sum(CASE WHEN (isnotnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)#7], 0
      +- ShuffleQueryStage X
         +- NativeShuffleExchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=1]
            +- NativeHashAggregate HashAgg, [partial_sum(_c0#9), partial_sum(_c1#10), partial_sum(_c2#11)], [sum#12, sum#13, sum#14], 0
               +- NativeProject [CASE WHEN (isnotnull(customer_sk#1) AND isnull(customer_sk#2)) THEN 1 ELSE 0 END AS _c0#9, CASE WHEN (isnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END AS _c1#10, CASE WHEN (isnotnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END AS _c2#11]
                  +- NativeProject [customer_sk#1, customer_sk#2]
                     +- NativeSortMergeJoin [customer_sk#1, item_sk#15], [customer_sk#2, item_sk#16], FullOuter
                        :- NativeSort [customer_sk#1 ASC NULLS FIRST, item_sk#15 ASC NULLS FIRST], false
                        :  +- NativeProject [ss_customer_sk#17 AS customer_sk#1, ss_item_sk#18 AS item_sk#15]
                        :     +- NativeHashAggregate HashAgg, ArrayBuffer(ss_customer_sk#17, ss_item_sk#18), [ss_customer_sk#17, ss_item_sk#18], 2
                        :        +- InputAdapter
                        :           +- AQEShuffleRead coalesced
                        :              +- ShuffleQueryStage X
                        :                 +- NativeShuffleExchange hashpartitioning(ss_customer_sk#17, ss_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                        :                    +- NativeHashAggregate HashAgg, [ss_customer_sk#17, ss_item_sk#18], 0
                        :                       +- NativeProject [ss_item_sk#18, ss_customer_sk#17]
                        :                          +- NativeSortMergeJoin [ss_sold_date_sk#19], [d_date_sk#20], Inner
                        :                             :- NativeSort [ss_sold_date_sk#19 ASC NULLS FIRST], false
                        :                             :  +- InputAdapter
                        :                             :     +- AQEShuffleRead coalesced
                        :                             :        +- ShuffleQueryStage X
                        :                             :           +- NativeShuffleExchange hashpartitioning(ss_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                        :                             :              +- NativeFilter isnotnull(ss_sold_date_sk#19)
                        :                             :                 +- InputAdapter [#19, #18, #17]
                        :                             :                    +- NativeParquetScan  (FileScan parquet [ss_sold_date_sk#19,ss_item_sk#18,ss_customer_sk#17] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_customer_sk:int>)
                        :                             +- NativeSort [d_date_sk#20 ASC NULLS FIRST], false
                        :                                +- InputAdapter
                        :                                   +- AQEShuffleRead coalesced
                        :                                      +- ShuffleQueryStage X
                        :                                         +- NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                        :                                            +- NativeProject [d_date_sk#20]
                        :                                               +- NativeFilter (((isnotnull(d_month_seq#21) AND (d_month_seq#21 >= 1200)) AND (d_month_seq#21 <= 1211)) AND isnotnull(d_date_sk#20))
                        :                                                  +- InputAdapter [#20, #21]
                        :                                                     +- NativeParquetScan  (FileScan parquet [d_date_sk#20,d_month_seq#21] Batched: true, DataFilters: [isnotnull(d_month_seq#21), (d_month_seq#21 >= 1200), (d_month_seq#21 <= 1211), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>)
                        +- NativeSort [customer_sk#2 ASC NULLS FIRST, item_sk#16 ASC NULLS FIRST], false
                           +- NativeProject [cs_bill_customer_sk#22 AS customer_sk#2, cs_item_sk#23 AS item_sk#16]
                              +- NativeHashAggregate HashAgg, ArrayBuffer(cs_bill_customer_sk#22, cs_item_sk#23), [cs_bill_customer_sk#22, cs_item_sk#23], 2
                                 +- InputAdapter
                                    +- AQEShuffleRead coalesced
                                       +- ShuffleQueryStage X
                                          +- NativeShuffleExchange hashpartitioning(cs_bill_customer_sk#22, cs_item_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                                             +- NativeHashAggregate HashAgg, [cs_bill_customer_sk#22, cs_item_sk#23], 0
                                                +- NativeProject [cs_bill_customer_sk#22, cs_item_sk#23]
                                                   +- NativeSortMergeJoin [cs_sold_date_sk#24], [d_date_sk#25], Inner
                                                      :- NativeSort [cs_sold_date_sk#24 ASC NULLS FIRST], false
                                                      :  +- InputAdapter
                                                      :     +- AQEShuffleRead coalesced
                                                      :        +- ShuffleQueryStage X
                                                      :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                                                      :              +- NativeFilter isnotnull(cs_sold_date_sk#24)
                                                      :                 +- InputAdapter [#24, #22, #23]
                                                      :                    +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#24,cs_bill_customer_sk#22,cs_item_sk#23] Batched: true, DataFilters: [isnotnull(cs_sold_date_sk#24)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_item_sk:int>)
                                                      +- NativeSort [d_date_sk#25 ASC NULLS FIRST], false
                                                         +- InputAdapter
                                                            +- InputAdapter [#25]
                                                               +- AQEShuffleRead coalesced
                                                                  +- ShuffleQueryStage X
                                                                     +- ReusedExchange [d_date_sk#25], NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=4]
+- == Initial Plan ==
   HashAggregate(keys=[], functions=[sum(CASE WHEN (isnotnull(customer_sk#1) AND isnull(customer_sk#2)) THEN 1 ELSE 0 END), sum(CASE WHEN (isnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END), sum(CASE WHEN (isnotnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)], output=[store_only#4, catalog_only#6, store_and_catalog#8])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=7]
      +- HashAggregate(keys=[], functions=[partial_sum(CASE WHEN (isnotnull(customer_sk#1) AND isnull(customer_sk#2)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (isnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (isnotnull(customer_sk#1) AND isnotnull(customer_sk#2)) THEN 1 ELSE 0 END)], output=[sum#26, sum#27, sum#28])
         +- Project [customer_sk#1, customer_sk#2]
            +- SortMergeJoin [customer_sk#1, item_sk#15], [customer_sk#2, item_sk#16], FullOuter
               :- Sort [customer_sk#1 ASC NULLS FIRST, item_sk#15 ASC NULLS FIRST], false, 0
               :  +- HashAggregate(keys=[ss_customer_sk#17, ss_item_sk#18], functions=[], output=[customer_sk#1, item_sk#15])
               :     +- Exchange hashpartitioning(ss_customer_sk#17, ss_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=8]
               :        +- HashAggregate(keys=[ss_customer_sk#17, ss_item_sk#18], functions=[], output=[ss_customer_sk#17, ss_item_sk#18])
               :           +- Project [ss_item_sk#18, ss_customer_sk#17]
               :              +- SortMergeJoin [ss_sold_date_sk#19], [d_date_sk#20], Inner
               :                 :- Sort [ss_sold_date_sk#19 ASC NULLS FIRST], false, 0
               :                 :  +- Exchange hashpartitioning(ss_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=9]
               :                 :     +- Filter isnotnull(ss_sold_date_sk#19)
               :                 :        +- FileScan parquet [ss_sold_date_sk#19,ss_item_sk#18,ss_customer_sk#17] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_customer_sk:int>
               :                 +- Sort [d_date_sk#20 ASC NULLS FIRST], false, 0
               :                    +- Exchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=10]
               :                       +- Project [d_date_sk#20]
               :                          +- Filter (((isnotnull(d_month_seq#21) AND (d_month_seq#21 >= 1200)) AND (d_month_seq#21 <= 1211)) AND isnotnull(d_date_sk#20))
               :                             +- FileScan parquet [d_date_sk#20,d_month_seq#21] Batched: true, DataFilters: [isnotnull(d_month_seq#21), (d_month_seq#21 >= 1200), (d_month_seq#21 <= 1211), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
               +- Sort [customer_sk#2 ASC NULLS FIRST, item_sk#16 ASC NULLS FIRST], false, 0
                  +- HashAggregate(keys=[cs_bill_customer_sk#22, cs_item_sk#23], functions=[], output=[customer_sk#2, item_sk#16])
                     +- Exchange hashpartitioning(cs_bill_customer_sk#22, cs_item_sk#23, 100), ENSURE_REQUIREMENTS, [plan_id=11]
                        +- HashAggregate(keys=[cs_bill_customer_sk#22, cs_item_sk#23], functions=[], output=[cs_bill_customer_sk#22, cs_item_sk#23])
                           +- Project [cs_bill_customer_sk#22, cs_item_sk#23]
                              +- SortMergeJoin [cs_sold_date_sk#24], [d_date_sk#25], Inner
                                 :- Sort [cs_sold_date_sk#24 ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(cs_sold_date_sk#24, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                                 :     +- Filter isnotnull(cs_sold_date_sk#24)
                                 :        +- FileScan parquet [cs_sold_date_sk#24,cs_bill_customer_sk#22,cs_item_sk#23] Batched: true, DataFilters: [isnotnull(cs_sold_date_sk#24)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_item_sk:int>
                                 +- Sort [d_date_sk#25 ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(d_date_sk#25, 100), ENSURE_REQUIREMENTS, [plan_id=13]
                                       +- Project [d_date_sk#25]
                                          +- Filter (((isnotnull(d_month_seq#29) AND (d_month_seq#29 >= 1200)) AND (d_month_seq#29 <= 1211)) AND isnotnull(d_date_sk#25))
                                             +- FileScan parquet [d_date_sk#25,d_month_seq#29] Batched: true, DataFilters: [isnotnull(d_month_seq#29), (d_month_seq#29 >= 1200), (d_month_seq#29 <= 1211), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
