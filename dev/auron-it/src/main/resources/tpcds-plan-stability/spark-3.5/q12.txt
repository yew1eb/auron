AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[i_category#1 ASC NULLS FIRST,i_class#2 ASC NULLS FIRST,i_item_id#3 ASC NULLS FIRST,i_item_desc#4 ASC NULLS FIRST,revenueratio#5 ASC NULLS FIRST], output=[i_item_desc#4,i_category#1,i_class#2,i_current_price#6,itemrevenue#7,revenueratio#5])
   +- *(1) Project [i_item_desc#4, i_category#1, i_class#2, i_current_price#6, itemrevenue#7, ((_w0#8 * 100) / _we0#9) AS revenueratio#5, i_item_id#3]
      +- Window [sum(_w0#8) windowspecdefinition(i_class#2, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#9], [i_class#2]
         +- NativeSort [i_class#2 ASC NULLS FIRST], false
            +- InputAdapter
               +- AQEShuffleRead coalesced
                  +- ShuffleQueryStage 5
                     +- NativeShuffleExchange hashpartitioning(i_class#2, 100), ENSURE_REQUIREMENTS, [plan_id=1]
                        +- NativeProject [i_item_desc#4, i_category#1, i_class#2, i_current_price#6, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#10))#11,17,2) AS itemrevenue#7, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#10))#11,17,2) AS _w0#8, i_item_id#3]
                           +- NativeHashAggregate HashAgg, ArrayBuffer(i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6), [i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6], [sum(UnscaledValue(ws_ext_sales_price#10))], [sum(UnscaledValue(ws_ext_sales_price#10))#11], 5
                              +- InputAdapter
                                 +- AQEShuffleRead coalesced
                                    +- ShuffleQueryStage 4
                                       +- NativeShuffleExchange hashpartitioning(i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                                          +- NativeHashAggregate HashAgg, [i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6], [partial_sum(_c5#12)], [sum#13], 0
                                             +- NativeProject [i_item_id#3 AS i_item_id#3, i_item_desc#4 AS i_item_desc#4, i_category#1 AS i_category#1, i_class#2 AS i_class#2, i_current_price#6 AS i_current_price#6, UnscaledValue(ws_ext_sales_price#10) AS _c5#12]
                                                +- NativeProject [ws_ext_sales_price#10, i_item_id#3, i_item_desc#4, i_current_price#6, i_class#2, i_category#1]
                                                   +- NativeSortMergeJoin [ws_sold_date_sk#14], [d_date_sk#15], Inner
                                                      :- NativeSort [ws_sold_date_sk#14 ASC NULLS FIRST], false
                                                      :  +- InputAdapter
                                                      :     +- AQEShuffleRead coalesced
                                                      :        +- ShuffleQueryStage 3
                                                      :           +- NativeShuffleExchange hashpartitioning(ws_sold_date_sk#14, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                                                      :              +- NativeProject [ws_sold_date_sk#14, ws_ext_sales_price#10, i_item_id#3, i_item_desc#4, i_current_price#6, i_class#2, i_category#1]
                                                      :                 +- NativeSortMergeJoin [ws_item_sk#16], [i_item_sk#17], Inner
                                                      :                    :- NativeSort [ws_item_sk#16 ASC NULLS FIRST], false
                                                      :                    :  +- InputAdapter
                                                      :                    :     +- AQEShuffleRead coalesced
                                                      :                    :        +- ShuffleQueryStage 0
                                                      :                    :           +- NativeShuffleExchange hashpartitioning(ws_item_sk#16, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                                                      :                    :              +- NativeFilter (isnotnull(ws_item_sk#16) AND isnotnull(ws_sold_date_sk#14))
                                                      :                    :                 +- InputAdapter [#14, #16, #10]
                                                      :                    :                    +- NativeParquetScan  (FileScan parquet [ws_sold_date_sk#14,ws_item_sk#16,ws_ext_sales_price#10] Batched: true, DataFilters: [isnotnull(ws_item_sk#16), isnotnull(ws_sold_date_sk#14)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_ext_sales_price:decimal(7,2)>)
                                                      :                    +- NativeSort [i_item_sk#17 ASC NULLS FIRST], false
                                                      :                       +- InputAdapter
                                                      :                          +- AQEShuffleRead coalesced
                                                      :                             +- ShuffleQueryStage 1
                                                      :                                +- NativeShuffleExchange hashpartitioning(i_item_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                                                      :                                   +- NativeFilter (i_category#1 IN (Sports,Books,Home) AND isnotnull(i_item_sk#17))
                                                      :                                      +- InputAdapter [#17, #3, #4, #6, #2, #1]
                                                      :                                         +- NativeParquetScan  (FileScan parquet [i_item_sk#17,i_item_id#3,i_item_desc#4,i_current_price#6,i_class#2,i_category#1] Batched: true, DataFilters: [i_category#1 IN (Sports,Books,Home), isnotnull(i_item_sk#17)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [In(i_category, [Books,Home,Sports]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_class:str...)
                                                      +- NativeSort [d_date_sk#15 ASC NULLS FIRST], false
                                                         +- InputAdapter
                                                            +- AQEShuffleRead coalesced
                                                               +- ShuffleQueryStage 2
                                                                  +- NativeShuffleExchange hashpartitioning(d_date_sk#15, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                                                                     +- NativeProject [d_date_sk#15]
                                                                        +- NativeFilter (((isnotnull(d_date#18) AND (d_date#18 >= 1999-02-22)) AND (d_date#18 <= 1999-03-24)) AND isnotnull(d_date_sk#15))
                                                                           +- InputAdapter [#15, #18]
                                                                              +- NativeParquetScan  (FileScan parquet [d_date_sk#15,d_date#18] Batched: true, DataFilters: [isnotnull(d_date#18), (d_date#18 >= 1999-02-22), (d_date#18 <= 1999-03-24), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-22), LessThanOrEqual(d_date,1999-03-24), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>)
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[i_category#1 ASC NULLS FIRST,i_class#2 ASC NULLS FIRST,i_item_id#3 ASC NULLS FIRST,i_item_desc#4 ASC NULLS FIRST,revenueratio#5 ASC NULLS FIRST], output=[i_item_desc#4,i_category#1,i_class#2,i_current_price#6,itemrevenue#7,revenueratio#5])
   +- Project [i_item_desc#4, i_category#1, i_class#2, i_current_price#6, itemrevenue#7, ((_w0#8 * 100) / _we0#9) AS revenueratio#5, i_item_id#3]
      +- Window [sum(_w0#8) windowspecdefinition(i_class#2, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#9], [i_class#2]
         +- Sort [i_class#2 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_class#2, 100), ENSURE_REQUIREMENTS, [plan_id=7]
               +- HashAggregate(keys=[i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6], functions=[sum(UnscaledValue(ws_ext_sales_price#10))], output=[i_item_desc#4, i_category#1, i_class#2, i_current_price#6, itemrevenue#7, _w0#8, i_item_id#3])
                  +- Exchange hashpartitioning(i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6, 100), ENSURE_REQUIREMENTS, [plan_id=8]
                     +- HashAggregate(keys=[i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#10))], output=[i_item_id#3, i_item_desc#4, i_category#1, i_class#2, i_current_price#6, sum#19])
                        +- Project [ws_ext_sales_price#10, i_item_id#3, i_item_desc#4, i_current_price#6, i_class#2, i_category#1]
                           +- SortMergeJoin [ws_sold_date_sk#14], [d_date_sk#15], Inner
                              :- Sort [ws_sold_date_sk#14 ASC NULLS FIRST], false, 0
                              :  +- Exchange hashpartitioning(ws_sold_date_sk#14, 100), ENSURE_REQUIREMENTS, [plan_id=9]
                              :     +- Project [ws_sold_date_sk#14, ws_ext_sales_price#10, i_item_id#3, i_item_desc#4, i_current_price#6, i_class#2, i_category#1]
                              :        +- SortMergeJoin [ws_item_sk#16], [i_item_sk#17], Inner
                              :           :- Sort [ws_item_sk#16 ASC NULLS FIRST], false, 0
                              :           :  +- Exchange hashpartitioning(ws_item_sk#16, 100), ENSURE_REQUIREMENTS, [plan_id=10]
                              :           :     +- Filter (isnotnull(ws_item_sk#16) AND isnotnull(ws_sold_date_sk#14))
                              :           :        +- FileScan parquet [ws_sold_date_sk#14,ws_item_sk#16,ws_ext_sales_price#10] Batched: true, DataFilters: [isnotnull(ws_item_sk#16), isnotnull(ws_sold_date_sk#14)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_ext_sales_price:decimal(7,2)>
                              :           +- Sort [i_item_sk#17 ASC NULLS FIRST], false, 0
                              :              +- Exchange hashpartitioning(i_item_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=11]
                              :                 +- Filter (i_category#1 IN (Sports,Books,Home) AND isnotnull(i_item_sk#17))
                              :                    +- FileScan parquet [i_item_sk#17,i_item_id#3,i_item_desc#4,i_current_price#6,i_class#2,i_category#1] Batched: true, DataFilters: [i_category#1 IN (Sports,Books,Home), isnotnull(i_item_sk#17)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [In(i_category, [Books,Home,Sports]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_class:str...
                              +- Sort [d_date_sk#15 ASC NULLS FIRST], false, 0
                                 +- Exchange hashpartitioning(d_date_sk#15, 100), ENSURE_REQUIREMENTS, [plan_id=12]
                                    +- Project [d_date_sk#15]
                                       +- Filter (((isnotnull(d_date#18) AND (d_date#18 >= 1999-02-22)) AND (d_date#18 <= 1999-03-24)) AND isnotnull(d_date_sk#15))
                                          +- FileScan parquet [d_date_sk#15,d_date#18] Batched: true, DataFilters: [isnotnull(d_date#18), (d_date#18 >= 1999-02-22), (d_date#18 <= 1999-03-24), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-22), LessThanOrEqual(d_date,1999-03-24), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>
