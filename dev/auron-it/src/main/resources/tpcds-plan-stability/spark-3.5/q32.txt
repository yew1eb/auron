AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeProject [MakeDecimal(sum(UnscaledValue(cs_ext_discount_amt#1))#2,17,2) AS excess discount amount#3]
   +- NativeHashAggregate HashAgg, List(), [sum(UnscaledValue(cs_ext_discount_amt#1))], [sum(UnscaledValue(cs_ext_discount_amt#1))#2], 0
      +- ShuffleQueryStage X
         +- NativeShuffleExchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=1]
            +- NativeHashAggregate HashAgg, [partial_sum(_c0#4)], [sum#5], 0
               +- NativeProject [UnscaledValue(cs_ext_discount_amt#1) AS _c0#4]
                  +- NativeProject [cs_ext_discount_amt#1]
                     +- NativeSortMergeJoin [cs_sold_date_sk#6], [d_date_sk#7], Inner
                        :- NativeSort [cs_sold_date_sk#6 ASC NULLS FIRST], false
                        :  +- InputAdapter
                        :     +- AQEShuffleRead coalesced
                        :        +- ShuffleQueryStage X
                        :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#6, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                        :              +- ConvertToNative
                        :                 +- *(1) Project [cs_sold_date_sk#6, cs_ext_discount_amt#1]
                        :                    +- *(1) SortMergeJoin [i_item_sk#8], [cs_item_sk#9], Inner, (cast(cs_ext_discount_amt#1 as decimal(14,7)) > (1.3 * avg(cs_ext_discount_amt))#10)
                        :                       :- NativeProject [cs_sold_date_sk#6, cs_ext_discount_amt#1, i_item_sk#8]
                        :                       :  +- NativeSortMergeJoin [cs_item_sk#11], [i_item_sk#8], Inner
                        :                       :     :- NativeSort [cs_item_sk#11 ASC NULLS FIRST], false
                        :                       :     :  +- InputAdapter
                        :                       :     :     +- AQEShuffleRead coalesced
                        :                       :     :        +- ShuffleQueryStage X
                        :                       :     :           +- NativeShuffleExchange hashpartitioning(cs_item_sk#11, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                        :                       :     :              +- NativeFilter ((isnotnull(cs_item_sk#11) AND isnotnull(cs_ext_discount_amt#1)) AND isnotnull(cs_sold_date_sk#6))
                        :                       :     :                 +- InputAdapter [#6, #11, #1]
                        :                       :     :                    +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#6,cs_item_sk#11,cs_ext_discount_amt#1] Batched: true, DataFilters: [isnotnull(cs_item_sk#11), isnotnull(cs_ext_discount_amt#1), isnotnull(cs_sold_date_sk#12..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_ext_discount_amt), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>)
                        :                       :     +- NativeSort [i_item_sk#8 ASC NULLS FIRST], false
                        :                       :        +- InputAdapter
                        :                       :           +- AQEShuffleRead coalesced
                        :                       :              +- ShuffleQueryStage X
                        :                       :                 +- NativeShuffleExchange hashpartitioning(i_item_sk#8, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                        :                       :                    +- NativeProject [i_item_sk#8]
                        :                       :                       +- NativeFilter ((isnotnull(i_manufact_id#13) AND (i_manufact_id#13 = 269)) AND isnotnull(i_item_sk#8))
                        :                       :                          +- InputAdapter [#8, #13]
                        :                       :                             +- NativeParquetScan  (FileScan parquet [i_item_sk#8,i_manufact_id#13] Batched: true, DataFilters: [isnotnull(i_manufact_id#13), (i_manufact_id#13 = 269), isnotnull(i_item_sk#8)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,269), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_manufact_id:int>)
                        :                       +- NativeSort [cs_item_sk#9 ASC NULLS FIRST], false
                        :                          +- NativeFilter isnotnull((1.3 * avg(cs_ext_discount_amt))#10)
                        :                             +- NativeProject [(1.3 * cast((avg(UnscaledValue(cs_ext_discount_amt#14))#15 / 100.0) as decimal(11,6))) AS (1.3 * avg(cs_ext_discount_amt))#10, cs_item_sk#9]
                        :                                +- NativeHashAggregate HashAgg, List(cs_item_sk#9), [cs_item_sk#9], [avg(UnscaledValue(cs_ext_discount_amt#14))], [avg(UnscaledValue(cs_ext_discount_amt#14))#15], 1
                        :                                   +- InputAdapter
                        :                                      +- AQEShuffleRead coalesced
                        :                                         +- ShuffleQueryStage X
                        :                                            +- NativeShuffleExchange hashpartitioning(cs_item_sk#9, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                        :                                               +- NativeHashAggregate HashAgg, [cs_item_sk#9], [partial_avg(_c1#16)], [sum#17, count#18], 0
                        :                                                  +- NativeProject [cs_item_sk#9 AS cs_item_sk#9, UnscaledValue(cs_ext_discount_amt#14) AS _c1#16]
                        :                                                     +- NativeProject [cs_item_sk#9, cs_ext_discount_amt#14]
                        :                                                        +- NativeSortMergeJoin [cs_sold_date_sk#19], [d_date_sk#20], Inner
                        :                                                           :- NativeSort [cs_sold_date_sk#19 ASC NULLS FIRST], false
                        :                                                           :  +- InputAdapter
                        :                                                           :     +- AQEShuffleRead coalesced
                        :                                                           :        +- ShuffleQueryStage X
                        :                                                           :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                        :                                                           :              +- NativeFilter (isnotnull(cs_sold_date_sk#19) AND isnotnull(cs_item_sk#9))
                        :                                                           :                 +- InputAdapter [#19, #9, #14]
                        :                                                           :                    +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#19,cs_item_sk#9,cs_ext_discount_amt#14] Batched: true, DataFilters: [isnotnull(cs_sold_date_sk#19), isnotnull(cs_item_sk#9)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>)
                        :                                                           +- NativeSort [d_date_sk#20 ASC NULLS FIRST], false
                        :                                                              +- InputAdapter
                        :                                                                 +- AQEShuffleRead coalesced
                        :                                                                    +- ShuffleQueryStage X
                        :                                                                       +- NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=7]
                        :                                                                          +- NativeProject [d_date_sk#20]
                        :                                                                             +- NativeFilter (((isnotnull(d_date#21) AND (d_date#21 >= 1998-03-18)) AND (d_date#21 <= 1998-06-16)) AND isnotnull(d_date_sk#20))
                        :                                                                                +- InputAdapter [#20, #21]
                        :                                                                                   +- NativeParquetScan  (FileScan parquet [d_date_sk#20,d_date#21] Batched: true, DataFilters: [isnotnull(d_date#21), (d_date#21 >= 1998-03-18), (d_date#21 <= 1998-06-16), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>)
                        +- NativeSort [d_date_sk#7 ASC NULLS FIRST], false
                           +- InputAdapter
                              +- InputAdapter [#7]
                                 +- AQEShuffleRead coalesced
                                    +- ShuffleQueryStage X
                                       +- ReusedExchange [d_date_sk#7], NativeShuffleExchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=7]
+- == Initial Plan ==
   HashAggregate(keys=[], functions=[sum(UnscaledValue(cs_ext_discount_amt#1))], output=[excess discount amount#3])
   +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [plan_id=8]
      +- HashAggregate(keys=[], functions=[partial_sum(UnscaledValue(cs_ext_discount_amt#1))], output=[sum#22])
         +- Project [cs_ext_discount_amt#1]
            +- SortMergeJoin [cs_sold_date_sk#6], [d_date_sk#7], Inner
               :- Sort [cs_sold_date_sk#6 ASC NULLS FIRST], false, 0
               :  +- Exchange hashpartitioning(cs_sold_date_sk#6, 100), ENSURE_REQUIREMENTS, [plan_id=9]
               :     +- Project [cs_sold_date_sk#6, cs_ext_discount_amt#1]
               :        +- SortMergeJoin [i_item_sk#8], [cs_item_sk#9], Inner, (cast(cs_ext_discount_amt#1 as decimal(14,7)) > (1.3 * avg(cs_ext_discount_amt))#10)
               :           :- Project [cs_sold_date_sk#6, cs_ext_discount_amt#1, i_item_sk#8]
               :           :  +- SortMergeJoin [cs_item_sk#11], [i_item_sk#8], Inner
               :           :     :- Sort [cs_item_sk#11 ASC NULLS FIRST], false, 0
               :           :     :  +- Exchange hashpartitioning(cs_item_sk#11, 100), ENSURE_REQUIREMENTS, [plan_id=10]
               :           :     :     +- Filter ((isnotnull(cs_item_sk#11) AND isnotnull(cs_ext_discount_amt#1)) AND isnotnull(cs_sold_date_sk#6))
               :           :     :        +- FileScan parquet [cs_sold_date_sk#6,cs_item_sk#11,cs_ext_discount_amt#1] Batched: true, DataFilters: [isnotnull(cs_item_sk#11), isnotnull(cs_ext_discount_amt#1), isnotnull(cs_sold_date_sk#12..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_ext_discount_amt), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>
               :           :     +- Sort [i_item_sk#8 ASC NULLS FIRST], false, 0
               :           :        +- Exchange hashpartitioning(i_item_sk#8, 100), ENSURE_REQUIREMENTS, [plan_id=11]
               :           :           +- Project [i_item_sk#8]
               :           :              +- Filter ((isnotnull(i_manufact_id#13) AND (i_manufact_id#13 = 269)) AND isnotnull(i_item_sk#8))
               :           :                 +- FileScan parquet [i_item_sk#8,i_manufact_id#13] Batched: true, DataFilters: [isnotnull(i_manufact_id#13), (i_manufact_id#13 = 269), isnotnull(i_item_sk#8)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,269), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_manufact_id:int>
               :           +- Sort [cs_item_sk#9 ASC NULLS FIRST], false, 0
               :              +- Filter isnotnull((1.3 * avg(cs_ext_discount_amt))#10)
               :                 +- HashAggregate(keys=[cs_item_sk#9], functions=[avg(UnscaledValue(cs_ext_discount_amt#14))], output=[(1.3 * avg(cs_ext_discount_amt))#10, cs_item_sk#9])
               :                    +- Exchange hashpartitioning(cs_item_sk#9, 100), ENSURE_REQUIREMENTS, [plan_id=12]
               :                       +- HashAggregate(keys=[cs_item_sk#9], functions=[partial_avg(UnscaledValue(cs_ext_discount_amt#14))], output=[cs_item_sk#9, sum#23, count#24])
               :                          +- Project [cs_item_sk#9, cs_ext_discount_amt#14]
               :                             +- SortMergeJoin [cs_sold_date_sk#19], [d_date_sk#20], Inner
               :                                :- Sort [cs_sold_date_sk#19 ASC NULLS FIRST], false, 0
               :                                :  +- Exchange hashpartitioning(cs_sold_date_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=13]
               :                                :     +- Filter (isnotnull(cs_sold_date_sk#19) AND isnotnull(cs_item_sk#9))
               :                                :        +- FileScan parquet [cs_sold_date_sk#19,cs_item_sk#9,cs_ext_discount_amt#14] Batched: true, DataFilters: [isnotnull(cs_sold_date_sk#19), isnotnull(cs_item_sk#9)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>
               :                                +- Sort [d_date_sk#20 ASC NULLS FIRST], false, 0
               :                                   +- Exchange hashpartitioning(d_date_sk#20, 100), ENSURE_REQUIREMENTS, [plan_id=14]
               :                                      +- Project [d_date_sk#20]
               :                                         +- Filter (((isnotnull(d_date#21) AND (d_date#21 >= 1998-03-18)) AND (d_date#21 <= 1998-06-16)) AND isnotnull(d_date_sk#20))
               :                                            +- FileScan parquet [d_date_sk#20,d_date#21] Batched: true, DataFilters: [isnotnull(d_date#21), (d_date#21 >= 1998-03-18), (d_date#21 <= 1998-06-16), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>
               +- Sort [d_date_sk#7 ASC NULLS FIRST], false, 0
                  +- Exchange hashpartitioning(d_date_sk#7, 100), ENSURE_REQUIREMENTS, [plan_id=15]
                     +- Project [d_date_sk#7]
                        +- Filter (((isnotnull(d_date#25) AND (d_date#25 >= 1998-03-18)) AND (d_date#25 <= 1998-06-16)) AND isnotnull(d_date_sk#7))
                           +- FileScan parquet [d_date_sk#7,d_date#25] Batched: true, DataFilters: [isnotnull(d_date#25), (d_date#25 >= 1998-03-18), (d_date#25 <= 1998-06-16), isnotnull(d..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1998-03-18), LessThanOrEqual(d_date,1998-06-16), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>
