AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   NativeTakeOrdered 100, [channel#1 ASC NULLS FIRST, col_name#2 ASC NULLS FIRST, d_year#3 ASC NULLS FIRST, d_qoy#4 ASC NULLS FIRST, i_category#5 ASC NULLS FIRST]
   +- NativeProject [channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5, count(1)#6 AS sales_cnt#7, MakeDecimal(sum(UnscaledValue(ext_sales_price#8))#9,17,2) AS sales_amt#10]
      +- NativeHashAggregate HashAgg, ArrayBuffer(channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5), [channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5], [count(1), sum(UnscaledValue(ext_sales_price#8))], [count(1)#6, sum(UnscaledValue(ext_sales_price#8))#9], 5
         +- InputAdapter
            +- AQEShuffleRead coalesced
               +- ShuffleQueryStage 16
                  +- NativeShuffleExchange hashpartitioning(channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5, 100), ENSURE_REQUIREMENTS, [plan_id=1]
                     +- NativeHashAggregate HashAgg, [channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5], [partial_count(1), partial_sum(_c5#11)], [count#12, sum#13], 0
                        +- NativeProject [channel#1 AS channel#1, col_name#2 AS col_name#2, d_year#3 AS d_year#3, d_qoy#4 AS d_qoy#4, i_category#5 AS i_category#5, UnscaledValue(ext_sales_price#8) AS _c5#11]
                           +- InputAdapter [#1, #2, #3, #4, #5, #8]
                              +- NativeUnion [channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5, ext_sales_price#8]
                                 :- NativeProject [store AS channel#1, ss_store_sk#14 AS col_name#2, d_year#3, d_qoy#4, i_category#5, ss_ext_sales_price#15 AS ext_sales_price#8]
                                 :  +- NativeSortMergeJoin [ss_sold_date_sk#16], [d_date_sk#17], Inner
                                 :     :- NativeSort [ss_sold_date_sk#16 ASC NULLS FIRST], false
                                 :     :  +- InputAdapter
                                 :     :     +- AQEShuffleRead coalesced
                                 :     :        +- ShuffleQueryStage 13
                                 :     :           +- NativeShuffleExchange hashpartitioning(ss_sold_date_sk#16, 100), ENSURE_REQUIREMENTS, [plan_id=2]
                                 :     :              +- NativeProject [ss_sold_date_sk#16, ss_store_sk#14, ss_ext_sales_price#15, i_category#5]
                                 :     :                 +- NativeSortMergeJoin [ss_item_sk#18], [i_item_sk#19], Inner
                                 :     :                    :- NativeSort [ss_item_sk#18 ASC NULLS FIRST], false
                                 :     :                    :  +- InputAdapter
                                 :     :                    :     +- AQEShuffleRead coalesced
                                 :     :                    :        +- ShuffleQueryStage 0
                                 :     :                    :           +- NativeShuffleExchange hashpartitioning(ss_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=3]
                                 :     :                    :              +- NativeFilter ((isnull(ss_store_sk#14) AND isnotnull(ss_item_sk#18)) AND isnotnull(ss_sold_date_sk#16))
                                 :     :                    :                 +- InputAdapter [#16, #18, #14, #15]
                                 :     :                    :                    +- NativeParquetScan  (FileScan parquet [ss_sold_date_sk#16,ss_item_sk#18,ss_store_sk#14,ss_ext_sales_price#15] Batched: true, DataFilters: [isnull(ss_store_sk#14), isnotnull(ss_item_sk#18), isnotnull(ss_sold_date_sk#16)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNull(ss_store_sk), IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_ext_sales_price:decimal(7,2)>)
                                 :     :                    +- NativeSort [i_item_sk#19 ASC NULLS FIRST], false
                                 :     :                       +- InputAdapter
                                 :     :                          +- AQEShuffleRead coalesced
                                 :     :                             +- ShuffleQueryStage 1
                                 :     :                                +- NativeShuffleExchange hashpartitioning(i_item_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                                 :     :                                   +- NativeFilter isnotnull(i_item_sk#19)
                                 :     :                                      +- InputAdapter [#19, #5]
                                 :     :                                         +- NativeParquetScan  (FileScan parquet [i_item_sk#19,i_category#5] Batched: true, DataFilters: [isnotnull(i_item_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category:string>)
                                 :     +- NativeSort [d_date_sk#17 ASC NULLS FIRST], false
                                 :        +- InputAdapter
                                 :           +- AQEShuffleRead coalesced
                                 :              +- ShuffleQueryStage 2
                                 :                 +- NativeShuffleExchange hashpartitioning(d_date_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                                 :                    +- NativeFilter isnotnull(d_date_sk#17)
                                 :                       +- InputAdapter [#17, #3, #4]
                                 :                          +- NativeParquetScan  (FileScan parquet [d_date_sk#17,d_year#3,d_qoy#4] Batched: true, DataFilters: [isnotnull(d_date_sk#17)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>)
                                 :- NativeProject [web AS channel#20, ws_ship_customer_sk#21 AS col_name#22, d_year#23, d_qoy#24, i_category#25, ws_ext_sales_price#26 AS ext_sales_price#27]
                                 :  +- NativeSortMergeJoin [ws_sold_date_sk#28], [d_date_sk#29], Inner
                                 :     :- NativeSort [ws_sold_date_sk#28 ASC NULLS FIRST], false
                                 :     :  +- InputAdapter
                                 :     :     +- AQEShuffleRead coalesced
                                 :     :        +- ShuffleQueryStage 14
                                 :     :           +- NativeShuffleExchange hashpartitioning(ws_sold_date_sk#28, 100), ENSURE_REQUIREMENTS, [plan_id=6]
                                 :     :              +- NativeProject [ws_sold_date_sk#28, ws_ship_customer_sk#21, ws_ext_sales_price#26, i_category#25]
                                 :     :                 +- NativeSortMergeJoin [ws_item_sk#30], [i_item_sk#31], Inner
                                 :     :                    :- NativeSort [ws_item_sk#30 ASC NULLS FIRST], false
                                 :     :                    :  +- InputAdapter
                                 :     :                    :     +- AQEShuffleRead coalesced
                                 :     :                    :        +- ShuffleQueryStage 3
                                 :     :                    :           +- NativeShuffleExchange hashpartitioning(ws_item_sk#30, 100), ENSURE_REQUIREMENTS, [plan_id=7]
                                 :     :                    :              +- NativeFilter ((isnull(ws_ship_customer_sk#21) AND isnotnull(ws_item_sk#30)) AND isnotnull(ws_sold_date_sk#28))
                                 :     :                    :                 +- InputAdapter [#28, #30, #21, #26]
                                 :     :                    :                    +- NativeParquetScan  (FileScan parquet [ws_sold_date_sk#28,ws_item_sk#30,ws_ship_customer_sk#21,ws_ext_sales_price#26] Batched: true, DataFilters: [isnull(ws_ship_customer_sk#21), isnotnull(ws_item_sk#30), isnotnull(ws_sold_date_sk#28)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNull(ws_ship_customer_sk), IsNotNull(ws_item_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_ship_customer_sk:int,ws_ext_sales_price:decimal(7,2)>)
                                 :     :                    +- NativeSort [i_item_sk#31 ASC NULLS FIRST], false
                                 :     :                       +- InputAdapter
                                 :     :                          +- InputAdapter [#31, #25]
                                 :     :                             +- AQEShuffleRead coalesced
                                 :     :                                +- ShuffleQueryStage 5
                                 :     :                                   +- ReusedExchange [i_item_sk#31, i_category#25], NativeShuffleExchange hashpartitioning(i_item_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                                 :     +- NativeSort [d_date_sk#29 ASC NULLS FIRST], false
                                 :        +- InputAdapter
                                 :           +- InputAdapter [#29, #23, #24]
                                 :              +- AQEShuffleRead coalesced
                                 :                 +- ShuffleQueryStage 7
                                 :                    +- ReusedExchange [d_date_sk#29, d_year#23, d_qoy#24], NativeShuffleExchange hashpartitioning(d_date_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=5]
                                 +- NativeProject [catalog AS channel#32, cs_ship_addr_sk#33 AS col_name#34, d_year#35, d_qoy#36, i_category#37, cs_ext_sales_price#38 AS ext_sales_price#39]
                                    +- NativeSortMergeJoin [cs_sold_date_sk#40], [d_date_sk#41], Inner
                                       :- NativeSort [cs_sold_date_sk#40 ASC NULLS FIRST], false
                                       :  +- InputAdapter
                                       :     +- AQEShuffleRead coalesced
                                       :        +- ShuffleQueryStage 15
                                       :           +- NativeShuffleExchange hashpartitioning(cs_sold_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=8]
                                       :              +- NativeProject [cs_sold_date_sk#40, cs_ship_addr_sk#33, cs_ext_sales_price#38, i_category#37]
                                       :                 +- NativeSortMergeJoin [cs_item_sk#42], [i_item_sk#43], Inner
                                       :                    :- NativeSort [cs_item_sk#42 ASC NULLS FIRST], false
                                       :                    :  +- InputAdapter
                                       :                    :     +- AQEShuffleRead coalesced
                                       :                    :        +- ShuffleQueryStage 8
                                       :                    :           +- NativeShuffleExchange hashpartitioning(cs_item_sk#42, 100), ENSURE_REQUIREMENTS, [plan_id=9]
                                       :                    :              +- NativeFilter ((isnull(cs_ship_addr_sk#33) AND isnotnull(cs_item_sk#42)) AND isnotnull(cs_sold_date_sk#40))
                                       :                    :                 +- InputAdapter [#40, #33, #42, #38]
                                       :                    :                    +- NativeParquetScan  (FileScan parquet [cs_sold_date_sk#40,cs_ship_addr_sk#33,cs_item_sk#42,cs_ext_sales_price#38] Batched: true, DataFilters: [isnull(cs_ship_addr_sk#33), isnotnull(cs_item_sk#42), isnotnull(cs_sold_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNull(cs_ship_addr_sk), IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_ship_addr_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>)
                                       :                    +- NativeSort [i_item_sk#43 ASC NULLS FIRST], false
                                       :                       +- InputAdapter
                                       :                          +- InputAdapter [#43, #37]
                                       :                             +- AQEShuffleRead coalesced
                                       :                                +- ShuffleQueryStage 10
                                       :                                   +- ReusedExchange [i_item_sk#43, i_category#37], NativeShuffleExchange hashpartitioning(i_item_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=4]
                                       +- NativeSort [d_date_sk#41 ASC NULLS FIRST], false
                                          +- InputAdapter
                                             +- InputAdapter [#41, #35, #36]
                                                +- AQEShuffleRead coalesced
                                                   +- ShuffleQueryStage 12
                                                      +- ReusedExchange [d_date_sk#41, d_year#35, d_qoy#36], NativeShuffleExchange hashpartitioning(d_date_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=5]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[channel#1 ASC NULLS FIRST,col_name#2 ASC NULLS FIRST,d_year#3 ASC NULLS FIRST,d_qoy#4 ASC NULLS FIRST,i_category#5 ASC NULLS FIRST], output=[channel#1,col_name#2,d_year#3,d_qoy#4,i_category#5,sales_cnt#7,sales_amt#10])
   +- HashAggregate(keys=[channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5], functions=[count(1), sum(UnscaledValue(ext_sales_price#8))], output=[channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5, sales_cnt#7, sales_amt#10])
      +- Exchange hashpartitioning(channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5, 100), ENSURE_REQUIREMENTS, [plan_id=10]
         +- HashAggregate(keys=[channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5], functions=[partial_count(1), partial_sum(UnscaledValue(ext_sales_price#8))], output=[channel#1, col_name#2, d_year#3, d_qoy#4, i_category#5, count#44, sum#45])
            +- Union
               :- Project [store AS channel#1, ss_store_sk#14 AS col_name#2, d_year#3, d_qoy#4, i_category#5, ss_ext_sales_price#15 AS ext_sales_price#8]
               :  +- SortMergeJoin [ss_sold_date_sk#16], [d_date_sk#17], Inner
               :     :- Sort [ss_sold_date_sk#16 ASC NULLS FIRST], false, 0
               :     :  +- Exchange hashpartitioning(ss_sold_date_sk#16, 100), ENSURE_REQUIREMENTS, [plan_id=11]
               :     :     +- Project [ss_sold_date_sk#16, ss_store_sk#14, ss_ext_sales_price#15, i_category#5]
               :     :        +- SortMergeJoin [ss_item_sk#18], [i_item_sk#19], Inner
               :     :           :- Sort [ss_item_sk#18 ASC NULLS FIRST], false, 0
               :     :           :  +- Exchange hashpartitioning(ss_item_sk#18, 100), ENSURE_REQUIREMENTS, [plan_id=12]
               :     :           :     +- Filter ((isnull(ss_store_sk#14) AND isnotnull(ss_item_sk#18)) AND isnotnull(ss_sold_date_sk#16))
               :     :           :        +- FileScan parquet [ss_sold_date_sk#16,ss_item_sk#18,ss_store_sk#14,ss_ext_sales_price#15] Batched: true, DataFilters: [isnull(ss_store_sk#14), isnotnull(ss_item_sk#18), isnotnull(ss_sold_date_sk#16)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNull(ss_store_sk), IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_ext_sales_price:decimal(7,2)>
               :     :           +- Sort [i_item_sk#19 ASC NULLS FIRST], false, 0
               :     :              +- Exchange hashpartitioning(i_item_sk#19, 100), ENSURE_REQUIREMENTS, [plan_id=13]
               :     :                 +- Filter isnotnull(i_item_sk#19)
               :     :                    +- FileScan parquet [i_item_sk#19,i_category#5] Batched: true, DataFilters: [isnotnull(i_item_sk#19)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category:string>
               :     +- Sort [d_date_sk#17 ASC NULLS FIRST], false, 0
               :        +- Exchange hashpartitioning(d_date_sk#17, 100), ENSURE_REQUIREMENTS, [plan_id=14]
               :           +- Filter isnotnull(d_date_sk#17)
               :              +- FileScan parquet [d_date_sk#17,d_year#3,d_qoy#4] Batched: true, DataFilters: [isnotnull(d_date_sk#17)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>
               :- Project [web AS channel#20, ws_ship_customer_sk#21 AS col_name#22, d_year#23, d_qoy#24, i_category#25, ws_ext_sales_price#26 AS ext_sales_price#27]
               :  +- SortMergeJoin [ws_sold_date_sk#28], [d_date_sk#29], Inner
               :     :- Sort [ws_sold_date_sk#28 ASC NULLS FIRST], false, 0
               :     :  +- Exchange hashpartitioning(ws_sold_date_sk#28, 100), ENSURE_REQUIREMENTS, [plan_id=15]
               :     :     +- Project [ws_sold_date_sk#28, ws_ship_customer_sk#21, ws_ext_sales_price#26, i_category#25]
               :     :        +- SortMergeJoin [ws_item_sk#30], [i_item_sk#31], Inner
               :     :           :- Sort [ws_item_sk#30 ASC NULLS FIRST], false, 0
               :     :           :  +- Exchange hashpartitioning(ws_item_sk#30, 100), ENSURE_REQUIREMENTS, [plan_id=16]
               :     :           :     +- Filter ((isnull(ws_ship_customer_sk#21) AND isnotnull(ws_item_sk#30)) AND isnotnull(ws_sold_date_sk#28))
               :     :           :        +- FileScan parquet [ws_sold_date_sk#28,ws_item_sk#30,ws_ship_customer_sk#21,ws_ext_sales_price#26] Batched: true, DataFilters: [isnull(ws_ship_customer_sk#21), isnotnull(ws_item_sk#30), isnotnull(ws_sold_date_sk#28)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNull(ws_ship_customer_sk), IsNotNull(ws_item_sk), IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_ship_customer_sk:int,ws_ext_sales_price:decimal(7,2)>
               :     :           +- Sort [i_item_sk#31 ASC NULLS FIRST], false, 0
               :     :              +- Exchange hashpartitioning(i_item_sk#31, 100), ENSURE_REQUIREMENTS, [plan_id=17]
               :     :                 +- Filter isnotnull(i_item_sk#31)
               :     :                    +- FileScan parquet [i_item_sk#31,i_category#25] Batched: true, DataFilters: [isnotnull(i_item_sk#31)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category:string>
               :     +- Sort [d_date_sk#29 ASC NULLS FIRST], false, 0
               :        +- Exchange hashpartitioning(d_date_sk#29, 100), ENSURE_REQUIREMENTS, [plan_id=18]
               :           +- Filter isnotnull(d_date_sk#29)
               :              +- FileScan parquet [d_date_sk#29,d_year#23,d_qoy#24] Batched: true, DataFilters: [isnotnull(d_date_sk#29)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>
               +- Project [catalog AS channel#32, cs_ship_addr_sk#33 AS col_name#34, d_year#35, d_qoy#36, i_category#37, cs_ext_sales_price#38 AS ext_sales_price#39]
                  +- SortMergeJoin [cs_sold_date_sk#40], [d_date_sk#41], Inner
                     :- Sort [cs_sold_date_sk#40 ASC NULLS FIRST], false, 0
                     :  +- Exchange hashpartitioning(cs_sold_date_sk#40, 100), ENSURE_REQUIREMENTS, [plan_id=19]
                     :     +- Project [cs_sold_date_sk#40, cs_ship_addr_sk#33, cs_ext_sales_price#38, i_category#37]
                     :        +- SortMergeJoin [cs_item_sk#42], [i_item_sk#43], Inner
                     :           :- Sort [cs_item_sk#42 ASC NULLS FIRST], false, 0
                     :           :  +- Exchange hashpartitioning(cs_item_sk#42, 100), ENSURE_REQUIREMENTS, [plan_id=20]
                     :           :     +- Filter ((isnull(cs_ship_addr_sk#33) AND isnotnull(cs_item_sk#42)) AND isnotnull(cs_sold_date_sk#40))
                     :           :        +- FileScan parquet [cs_sold_date_sk#40,cs_ship_addr_sk#33,cs_item_sk#42,cs_ext_sales_price#38] Batched: true, DataFilters: [isnull(cs_ship_addr_sk#33), isnotnull(cs_item_sk#42), isnotnull(cs_sold_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNull(cs_ship_addr_sk), IsNotNull(cs_item_sk), IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_ship_addr_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>
                     :           +- Sort [i_item_sk#43 ASC NULLS FIRST], false, 0
                     :              +- Exchange hashpartitioning(i_item_sk#43, 100), ENSURE_REQUIREMENTS, [plan_id=21]
                     :                 +- Filter isnotnull(i_item_sk#43)
                     :                    +- FileScan parquet [i_item_sk#43,i_category#37] Batched: true, DataFilters: [isnotnull(i_item_sk#43)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category:string>
                     +- Sort [d_date_sk#41 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(d_date_sk#41, 100), ENSURE_REQUIREMENTS, [plan_id=22]
                           +- Filter isnotnull(d_date_sk#41)
                              +- FileScan parquet [d_date_sk#41,d_year#35,d_qoy#36] Batched: true, DataFilters: [isnotnull(d_date_sk#41)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/<warehouse_dir>], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>
